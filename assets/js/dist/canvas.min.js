(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){var $=Backbone.$,CanvasApplication;CanvasApplication=Marionette.Application.extend({onBeforeStart:function(){if(window.location.origin!==window.parent.location.origin){console.log("The Canvas has a different origin than the Sidebar");return}if(!window.parent.app){$(window.parent.document).on("DOMContentLoaded readystatechange load",this.registerRemoteChannel.bind(this))}else{this.registerRemoteChannel()}},onStart:function(){this.allowableEvents=["canvas:dragstart","canvas:drag","canvas:dragend","history:restore","history:undo","history:redo","css:add","css:delete","css:update","css:clear","sidebar:setting:change","template:load"];this.addEventListeners()},addEventListeners:function(){var canvasApp=this;var resetCanvas=function(){canvasApp.channel.trigger("canvas:reset")};document.addEventListener("click",resetCanvas,false);document.addEventListener("dragover",resetCanvas,false);window.addEventListener("resize",resetCanvas,false);$("a").attr({target:"_blank",draggable:false});$("img").attr("draggable","false");$(document).on("keydown",function(e){if(e.ctrlKey&&89==e.keyCode){if(!_.contains(["INPUT","SELECT","TEXTAREA"],e.target.tagName)){canvasApp.channel.trigger("history:redo")}}});$(document).on("keydown",function(e){if(e.ctrlKey&&90==e.keyCode){if(!_.contains(["INPUT","SELECT","TEXTAREA"],e.target.tagName)){canvasApp.channel.trigger("history:undo")}}})},registerRemoteChannel:function(){var remoteChannel=parent.app.channel;var getLibrary=function(id){return remoteChannel.request("sidebar:library",id)};this.channel.reply("sidebar:library",getLibrary);this.listenTo(remoteChannel,"all",this.forwardRemoteEvent);remoteChannel.trigger("canvas:initialize")},forwardRemoteEvent:function(eventName){var validEvent=_.contains(this.allowableEvents,eventName);if(validEvent){this.channel.trigger.apply(this.channel,arguments)}}});module.exports=CanvasApplication},{}],2:[function(require,module,exports){(function(Behaviors){"use strict";Behaviors.Container=require("./components/behaviors/container");Behaviors.Draggable=require("./components/behaviors/draggable");Behaviors.Droppable=require("./components/behaviors/droppable");Behaviors.Editable=require("./components/behaviors/editable");Behaviors.Movable=require("./components/behaviors/movable");Marionette.Behaviors.behaviorsLookup=function(){return Behaviors};window.Tailor.Behaviors=Behaviors})(window.Tailor.Behaviors||{})},{"./components/behaviors/container":9,"./components/behaviors/draggable":10,"./components/behaviors/droppable":11,"./components/behaviors/editable":12,"./components/behaviors/movable":13}],3:[function(require,module,exports){(function(Views){"use strict";Views.TailorSection=require("./components/elements/wrappers/view-section");Views.TailorBox=require("./components/elements/wrappers/view-box");Views.TailorCard=require("./components/elements/wrappers/view-card");Views.TailorHero=require("./components/elements/wrappers/view-hero");Views.TailorColumn=require("./components/elements/children/view-column");Views.TailorTab=require("./components/elements/children/view-tab");Views.TailorToggle=require("./components/elements/children/view-toggle");Views.TailorListItem=require("./components/elements/children/view-list-item");Views.TailorCarouselItem=require("./components/elements/children/view-carousel-item");Views.TailorTabs=require("./components/elements/containers/view-tabs");Views.TailorCarousel=require("./components/elements/containers/view-carousel");Views.Element=require("./components/elements/view-element");Views.Container=require("./components/elements/view-container");Views.Wrapper=require("./components/elements/view-container");Views.Child=require("./components/elements/view-container");Views.lookup=function(tag,type){tag=tag.replace(/_/g," ").replace(/(?: |\b)(\w)/g,function(key){return key.toUpperCase().replace(/\s+/g,"")});if(Views.hasOwnProperty(tag)){return Views[tag]}if(type){type=type.replace(/_/g," ").replace(/(?: |\b)(\w)/g,function(key){return key.toUpperCase().replace(/\s+/g,"")});if(Views.hasOwnProperty(type)){return Views[type]}}return Views.Element};window.Tailor.Views=Views})(window.Tailor.Views||{})},{"./components/elements/children/view-carousel-item":16,"./components/elements/children/view-column":17,"./components/elements/children/view-list-item":18,"./components/elements/children/view-tab":19,"./components/elements/children/view-toggle":20,"./components/elements/containers/view-carousel":25,"./components/elements/containers/view-tabs":26,"./components/elements/view-container":27,"./components/elements/view-element":28,"./components/elements/wrappers/view-box":29,"./components/elements/wrappers/view-card":30,"./components/elements/wrappers/view-hero":31,"./components/elements/wrappers/view-section":32}],4:[function(require,module,exports){(function(Models){"use strict";Models.Container=require("./entities/models/elements/model-container");Models.Wrapper=require("./entities/models/elements/model-wrapper");Models.Child=require("./entities/models/elements/model-child");Models.Element=require("./entities/models/elements/element");Models.Section=require("./entities/models/elements/wrappers/section");Models.Row=require("./entities/models/elements/containers/row");Models.Column=require("./entities/models/elements/children/column");Models.GridItem=require("./entities/models/elements/children/grid-item");Models.Tabs=require("./entities/models/elements/containers/tabs");Models.Carousel=require("./entities/models/elements/containers/carousel");Models.lookup=function(tag,type){tag=tag.replace(/tailor_/g," ").replace(/_/g," ").replace(/(?: |\b)(\w)/g,function(key){return key.toUpperCase().replace(/\s+/g,"")});if(Models.hasOwnProperty(tag)){return Models[tag]}type=type.replace(/_/g," ").replace(/(?: |\b)(\w)/g,function(key){return key.toUpperCase().replace(/\s+/g,"")});if(Models.hasOwnProperty(type)){return Models[type]}return Models.Element};window.Tailor.Models=Models})(window.Tailor.Models||{})},{"./entities/models/elements/children/column":42,"./entities/models/elements/children/grid-item":43,"./entities/models/elements/containers/carousel":44,"./entities/models/elements/containers/row":45,"./entities/models/elements/containers/tabs":46,"./entities/models/elements/element":47,"./entities/models/elements/model-child":49,"./entities/models/elements/model-container":51,"./entities/models/elements/model-wrapper":52,"./entities/models/elements/wrappers/section":53}],5:[function(require,module,exports){Tailor.Objects=Tailor.Objects||{};(function(Tailor,Api,$){"use strict";var stylesheet=document.getElementById("tailor-custom-page-css");var originalCSS=stylesheet.innerHTML;var rules=[];var generateCSS=function(){var customCSS="";for(var settingId in rules){if(rules.hasOwnProperty(settingId)){var rule=rules[settingId];var selectorString=Tailor.CSS.parseSelectors(rule.selectors);var declarationString=Tailor.CSS.parseDeclarations(rule.declarations);customCSS+="\n"+selectorString+" {"+declarationString+"}"}}customCSS=originalCSS+customCSS;stylesheet.innerHTML=customCSS};Api.Setting("_post_title",function(to,from){$("h1, h2, h1 a, h2 a").each(function(){if(from==this.textContent){this.textContent=to}})});Api.Setting("_tailor_page_css",function(to,from){originalCSS=to;generateCSS()});Api.Setting("_tailor_section_width",function(to,from){var unit=to.replace(/[0-9]/g,"");var value=to.replace(unit,"");if(value){rules["sectionWidth"]={selectors:[".tailor-section .tailor-section__content"],declarations:{"max-width":value+unit}};generateCSS()}else if(rules["sectionWidth"]){delete rules["sectionWidth"];generateCSS()}});Api.Setting("_tailor_element_spacing",function(to,from){var value=to.replace(/[a-z]/g,"");var unit=to.replace(/[0-9]/g,"");if(value){rules["elementSpacing"]={selectors:[".tailor-element"],declarations:{"margin-bottom":value+unit}};generateCSS()}else if(rules["elementSpacing"]){delete rules["elementSpacing"];generateCSS()}});Api.Setting("_tailor_column_spacing",function(to,from){var value=to.replace(/[a-z]/g,"")/2;var unit=to.replace(/[0-9]/g,"");if(value){rules["columnSpacing"]={selectors:[".tailor-element.tailor-row .tailor-column"],declarations:{"padding-left":value+unit,"padding-right":value+unit}};rules["rowMargin"]={selectors:[".tailor-element.tailor-row"],declarations:{"margin-left":-value+unit,"margin-right":-value+unit}};generateCSS()}else if(rules["columnSpacing"]){delete rules["columnSpacing"];delete rules["rowMargin"];generateCSS()}});_.extend(Tailor.Objects,{Carousel:require("./components/carousel"),PostsCarousel:require("./components/carousel-simple"),Tabs:require("./components/tabs"),Toggles:require("./components/toggles"),Map:require("./components/map"),Masonry:require("./components/masonry"),Slideshow:require("./components/slideshow"),Lightbox:require("./components/lightbox")});Api.Element.onRender("tailor_section",function(atts,model){var section=this;Api.Setting("_tailor_section_width",function(to,from){section.triggerAll("element:parent:change",section)})});Api.Element.onRender("tailor_column",function(atts,model){var column=this;Api.Setting("_tailor_column_spacing",function(to,from){column.triggerAll("element:parent:change",column)})});Api.Element.onRender("tailor_carousel",function(atts,model){var carousel=this;var options={autoplay:"1"==atts.autoplay,arrows:"1"==atts.arrows,dots:false,fade:"1"==atts.fade&&"1"==atts.items_per_row,slidesToShow:parseInt(atts.items_per_row,10)||1,adaptiveHeight:true};carousel.$el.tailorCarousel(options);Api.Setting("_tailor_element_spacing",function(to,from){carousel.triggerAll("element:parent:change",carousel)})});Api.Element.onRender("tailor_posts",function(atts,model){var $el=this.$el;var options;if("carousel"==atts.layout){options={autoplay:"1"==atts.autoplay,arrows:"1"==atts.arrows,dots:"1"==atts.dots,fade:"1"==atts.fade&&"1"==atts.items_per_row,infinite:false,slidesToShow:parseInt(atts.items_per_row,10)||2};this.$el.tailorSimpleCarousel(options)}else if(atts.masonry){$el.tailorMasonry()}});Api.Element.onRender("tailor_gallery",function(atts,model){var $el=this.$el;var options;if("carousel"==atts.layout){options={autoplay:"1"==atts.autoplay,arrows:"1"==atts.arrows,dots:"1"==atts.dots,fade:"1"==atts.fade&&"1"==atts.items_per_row,infinite:false,slidesToShow:parseInt(atts.items_per_row,10)||2};$el.tailorSimpleCarousel(options)}else if("slideshow"==atts.layout){options={autoplay:"1"==atts.autoplay,arrows:"1"==atts.arrows,dots:false,fade:true,items:".tailor-slideshow__slide",adaptiveHeight:true,draggable:false,speed:250};if("1"==atts.thumbnails){options.customPaging=function(slider,i){var thumb=$(slider.$slides[i]).data("thumb");return'<img class="slick-thumbnail" src="'+thumb+'">'};options.dots=true}$el.tailorSlideshow(options)}else if(atts.masonry){$el.tailorMasonry()}if(this.el.classList.contains("is-lightbox-gallery")){$el.tailorLightbox({disableOn:function(){return $el.hasClass("is-selected")}})}});Api.Element.onRender("tailor_content",function(atts,model){this.$el.tailorLightbox({disableOn:function(){return $el.hasClass("is-selected")}})});Api.Element.onRender("tailor_tabs",function(atts,model){this.$el.tailorTabs()});Api.Element.onRender("tailor_toggles",function(atts,model){this.$el.tailorToggles()});Api.Element.onRender("tailor_map",function(atts,model){this.$el.tailorGoogleMap()})})(window.Tailor,window.Tailor.Api,jQuery)},{"./components/carousel":15,"./components/carousel-simple":14,"./components/lightbox":33,"./components/map":34,"./components/masonry":35,"./components/slideshow":36,"./components/tabs":37,"./components/toggles":38}],6:[function(require,module,exports){require("./utility/polyfills/classlist");require("./utility/polyfills/raf");var Application=require("./apps/canvas");window.app=new Application;window.Tailor={Api:{Setting:require("./components/api/setting"),Element:require("./components/api/element")},CSS:require("./utility/css")};window.ajax=require("./utility/ajax");(function(app,$){"use strict";require("./canvas-behaviors");require("./canvas-components");require("./canvas-entities");require("./canvas-preview");app.addRegions({canvasRegion:{selector:"#canvas",regionClass:require("./modules/canvas/canvas-region")},selectRegion:{selector:"#select",regionClass:require("./modules/tools/select-region")}});app.on("before:start",function(){app.module("entities:canvas",require("./entities/canvas"))});app.on("start",function(){app.module("module:canvas",require("./modules/canvas"));app.module("module:tools",require("./modules/tools"));app.module("module:stylesheet",require("./modules/stylesheet"))});$(document).ready(function(){app.start({elements:window._elements||[],nonces:window._nonces||[],l10n:window._l10n||[],mediaQueries:window._media_queries||{},cssRules:window._css_rules||{}})})})(window.app,jQuery)},{"./apps/canvas":1,"./canvas-behaviors":2,"./canvas-components":3,"./canvas-entities":4,"./canvas-preview":5,"./components/api/element":7,"./components/api/setting":8,"./entities/canvas":39,"./modules/canvas":54,"./modules/canvas/canvas-region":55,"./modules/stylesheet":57,"./modules/tools":59,"./modules/tools/select-region":60,"./utility/ajax":64,"./utility/css":65,"./utility/polyfills/classlist":66,"./utility/polyfills/raf":67}],7:[function(require,module,exports){var callbacks={render:[],destroy:[]};var registerCallback=function(event,tag,callback){if(callbacks.hasOwnProperty(event)&&"function"===typeof callback){callbacks[event][tag]=callbacks[event][tag]||[];callbacks[event][tag].push(callback)}};var onRender=function(view,atts){var model=view.model;var tag=model.get("tag");atts=atts||model.get("atts");if(callbacks.render[tag]){_.each(callbacks.render[tag],function(callback){callback.apply(view,[atts,model])})}};var onDestroy=function(view){var model=view.model;var tag=model.get("tag");if(callbacks.destroy[tag]){_.each(callbacks.destroy[tag],function(callback){callback.apply(view,[model.get("atts"),model])})}};window.app.listenTo(app.channel,"element:ready element:refresh",onRender);window.app.listenTo(app.channel,"element:destroy",onDestroy);module.exports={onRender:function(tag,callback){registerCallback("render",tag,callback)},onDestroy:function(tag,callback){registerCallback("destroy",tag,callback)}}},{}],8:[function(require,module,exports){var callbacks={};var onChange=function(setting){var settingId=setting.get("id");if(callbacks[settingId]){_.each(callbacks[settingId],function(callback){callback.apply(app,[setting.get("value"),setting.previous("value")])})}};app.listenTo(app.channel,"sidebar:setting:change",onChange);module.exports=function(id,callback){if("function"===typeof callback){callbacks[id]=callbacks[id]||[];callbacks[id].push(callback)}}},{}],9:[function(require,module,exports){module.exports=Marionette.Behavior.extend({events:{"container:add":"addChildView","container:remove":"removeChildView"},modelEvents:{"container:collapse":"onCollapse"},addChildView:function(e,childView){if(childView===this.view){return}var $el=this.view.$childViewContainer?this.view.$childViewContainer:this.$el;var index=$el.children().filter(":not( .tailor-column__helper )").index(childView.$el);this.view._updateIndices(childView,true,index);this.view.proxyChildEvents(childView);this.view.children.add(childView,childView.model.get("order"));childView._parent=this;this.view.triggerAll("element:child:add",this.view,false);e.stopPropagation()},removeChildView:function(e,childView){if(childView===this.view){return}this.view.stopListening(childView);this.view.children.remove(childView,childView.model.get("order"));this.view._updateIndices(childView,false);delete childView._parent;childView.$el.detach();this.view.triggerAll("element:child:remove",this.view,false);e.stopPropagation()},onCollapse:function(model,children){var containerView=this.view;var index=containerView.$el.index();var childView;var siblings;_.each(children,function(child){childView=this.view.children.findByModel(child);siblings=containerView.el.parentNode.children;childView.$el.insertAfter(siblings[index]);index++;containerView.stopListening(childView);containerView.children.remove(childView);containerView._updateIndices(childView,false);delete childView._parent;childView.$el.trigger("container:add",childView)},this);containerView.$el.trigger("container:remove",containerView);containerView.destroy()}})},{}],10:[function(require,module,exports){module.exports=Marionette.Behavior.extend({events:{dragstart:"onDragStart",dragend:"onDragEnd",drag:"onDrag"},onDragStart:function(e){app.channel.trigger("canvas:dragstart",e.originalEvent,this.view)},onDrag:function(e){app.channel.trigger("canvas:drag",e.originalEvent,this.view)},onDragEnd:function(e){app.channel.trigger("canvas:dragend",e.originalEvent,this.view)}})},{}],11:[function(require,module,exports){module.exports=Marionette.Behavior.extend({events:{dragover:"onDragOver",drop:"onDrop"},onDragOver:function(e){app.channel.trigger("canvas:dragover",e.originalEvent,this.view)},onDrop:function(e){app.channel.trigger("canvas:drop",e.originalEvent,this.view)}})},{}],12:[function(require,module,exports){module.exports=Marionette.Behavior.extend({events:{mouseover:"onMouseOver",mouseout:"onMouseOut",click:"onClick"},modelEvents:{select:"selectElement"},collectionEvents:{edit:"onEdit"},onRender:function(){this.view.el.title="Shift-click to edit this element"},onClick:function(e){if(e.shiftKey){this.editElement()}else{this.selectElement()}e.preventDefault();e.stopPropagation()},onMouseOver:function(e){this.view.$el.addClass("is-hovering");e.stopPropagation()},onMouseOut:function(e){this.view.$el.removeClass("is-hovering");e.stopPropagation()},editElement:function(){app.channel.trigger("modal:open",this.view.model)},selectElement:function(){app.channel.trigger("canvas:select",this.view)},onEdit:function(model,editing){this.view.$el.toggleClass("is-editing",model===this.view.model&&editing)}})},{}],13:[function(require,module,exports){module.exports=Marionette.Behavior.extend({modelEvents:{"add:child":"addChild","remove:child":"removeChild","insert:before":"insertBefore","insert:after":"insertAfter",insert:"insert",append:"append"},insert:function(model){model.trigger("append",this.view)},addChild:function(){this.view.$el.trigger("container:add",this.view)},removeChild:function(){this.view.$el.trigger("container:remove",this.view)},insertBefore:function(view){this.view.$el.insertBefore(view.$el)},insertAfter:function(view){this.view.$el.insertAfter(view.$el)},triggerEvent:function(view){view.$el.trigger("before:element:child:add",this.view)},append:function(view){var $el=view.$childViewContainer?view.$childViewContainer:view.$el;this.view.$el.appendTo($el)}})},{}],14:[function(require,module,exports){var $=window.jQuery,Carousel;Carousel=function(el,options,callbacks){this.el=el;this.$el=$(el);this.$wrap=this.$el.find(".tailor-carousel__wrap").first();this.options=$.extend({},this.defaults,options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Carousel.prototype={defaults:{items:".tailor-carousel__item",prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button"></button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button"></button>',adaptiveHeight:true,draggable:false,speed:250,slidesToShow:1,slidesToScroll:1,autoplay:false,arrows:false,dots:true,fade:false},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.slick(this.addEventListeners);if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:refresh",$.proxy(this.unSlick,this)).on("element:change:parent",$.proxy(this.maybeRefreshSlick,this)).on("before:element:copy",$.proxy(this.unSlick,this)).on("element:copy",$.proxy(this.slick,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:parent:change",$.proxy(this.maybeRefreshSlick,this))},maybeSlick:function(e){if(e.target==this.el){this.slick()}},maybeRefreshSlick:function(e){if(e.target==this.el){this.refreshSlick()}},maybeUnSlick:function(e){if(e.target==this.el){this.unSlick()}},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},slick:function(callback){var carousel=this;this.$el.imagesLoaded(function(){carousel.$wrap.slick(carousel.options);if("function"==typeof callback){callback.call(carousel)}})},refreshSlick:function(){this.$wrap.slick("refresh")},unSlick:function(){this.$wrap.slick("unslick")},destroy:function(){this.$el.off();this.unSlick();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorSimpleCarousel=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorSimpleCarousel");if(!instance){$.data(this,"tailorSimpleCarousel",new Carousel(this,options,callbacks))}})}},{}],15:[function(require,module,exports){var $=window.jQuery,Carousel;Carousel=function(el,options,callbacks){this.el=el;this.$el=$(el);this.$wrap=this.$el.find(".tailor-carousel__wrap").first();this.options=$.extend({},this.defaults,options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Carousel.prototype={defaults:{items:".tailor-carousel__item",prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button"></button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button"></button>',adaptiveHeight:false,draggable:false,speed:250,slidesToShow:1,slidesToScroll:1,initialSlide:0,autoplay:false,arrows:false,dots:false,fade:false,infinite:false},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.slickAt(0,this.addEventListeners);if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){var showEl=true;this.$el.on("before:element:refresh",$.proxy(this.maybeUnSlick,this)).on("element:refresh",$.proxy(this.refreshSlick,this)).on("element:change:parent",$.proxy(this.maybeRefreshSlick,this)).on("before:element:copy",$.proxy(this.maybeUnSlick,this)).on("element:copy",$.proxy(this.maybeSlick,this)).on("element:parent:change",$.proxy(this.maybeRefreshSlick,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("before:element:child:ready",$.proxy(this.maybeUnSlick,this)).on("element:child:ready",$.proxy(this.onReadyChild,this)).on("element:child:add",$.proxy(this.refreshSlick,this)).on("element:child:remove",$.proxy(this.onDestroyDescendant,this)).on("before:element:child:refresh",$.proxy(this.maybeUnSlick,this)).on("element:child:refresh",$.proxy(this.maybeSlick,this)).on("before:element:change:order",$.proxy(this.maybeUnSlick,this)).on("element:change:order",$.proxy(this.onReorderChild,this)).on("before:element:child:destroy",$.proxy(this.maybeUnSlick,this)).on("element:child:destroy",$.proxy(this.onDestroyChild,this)).on("element:descendant:add",$.proxy(this.refreshSlick,this)).on("element:descendant:remove",$.proxy(this.refreshSlick,this)).on("element:descendant:ready",$.proxy(this.refreshSlick,this)).on("element:descendant:destroy",$.proxy(this.onDestroyDescendant,this))},querySelectors:function(){if(this.$dots){this.$dots.off()}var carousel=this;carousel.$items=carousel.$wrap.find(" > "+carousel.options.items);carousel.$dots=carousel.$el.children(".slick-dots").find(" > li");carousel.$dots.on("click",function(e){var $dot=$(e.currentTarget);carousel.currentSlide=$dot.data("id");carousel.$wrap.slick("slickGoTo",$dot.index());e.preventDefault()});if(!carousel.currentSlide){var $activeSlide=carousel.$items.filter(function(){return this.classList.contains("slick-current")});carousel.currentSlide=$activeSlide.length?$activeSlide.id:carousel.$items[0].id}},updateDots:function(index){this.$dots.each(function(i,el){if(index==i){el.classList.add("slick-active")}else{el.classList.remove("slick-active")}});this.$dots.toggle(this.$dots.length/this.options.slidesToShow>1)},onReadyChild:function(e,childView){if(e.target==this.el){this.slickAt(childView.$el.index())}else{this.refreshSlick()}},onReorderChild:function(e,id,newIndex,oldIndex){if(e.target!==this.el){return}this.querySelectors();var $item=this.$items.filter(function(){return this.id==id});if(oldIndex-newIndex<0){$item.insertAfter(this.$items[newIndex])}else{$item.insertBefore(this.$items[newIndex])}this.slickAt(newIndex)},onDestroyChild:function(e,childView){var index=childView.$el.index();childView.$el.remove();this.slickAt(index)},onDestroyDescendant:function(e,childView){childView.$el.detach();this.refreshSlick()},maybeSlick:function(e){if(e.target==this.el){this.slick()}},maybeRefreshSlick:function(e){if(e.target==this.el){this.refreshSlick()}},maybeUnSlick:function(e){if(e.target==this.el){this.unSlick()}},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},slickAt:function(index,callback){this.querySelectors();var numberItems=this.$items.length;if(!numberItems){return}index=Math.min(index,numberItems-1);if(index<this.options.slidesToShow){index=0}var $item=this.$items[index];this.currentSlide=$item.id;this.slick(callback);this.updateDots(index)},slick:function(callback){var carousel=this;var currentSlide=this.currentSlide;var currentIndex=this.$dots.filter(function(){return this.getAttribute("data-id")==currentSlide}).index();var options=$.extend({},this.options,{autoplay:false,fade:false,initialSlide:currentIndex});carousel.$wrap.slick(options).on("beforeChange",function(event,slick,currentSlide,nextSlide){if(slick.$slider[0]==carousel.$wrap[0]&&currentSlide!=nextSlide){carousel.updateDots(nextSlide)}});if("function"==typeof callback){callback.call(carousel)}},refreshSlick:function(){this.$wrap.slick("refresh")},unSlick:function(){this.$wrap.slick("unslick")},destroy:function(){this.$el.off();this.unSlick();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorCarousel=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorCarousel");if(!instance){$.data(this,"tailorCarousel",new Carousel(this,options,callbacks))}})}},{}],16:[function(require,module,exports){var ContainerView=require("./../view-container"),CarouselItemView;CarouselItemView=ContainerView.extend({onRenderTemplate:function(){this.el.draggable=false;this.el.id=this.model.cid}});module.exports=CarouselItemView},{"./../view-container":27}],17:[function(require,module,exports){var ContainerView=require("./../view-container"),ColumnView;ColumnView=ContainerView.extend({ui:{sizer:".tailor-column__sizer"},events:{"mousedown @ui.sizer":"onResize"},modelEvents:{"change:atts":"onChangeAttributes","change:width":"onChangeWidth"},onRenderCollection:function(){this.updateClassName(this.model.get("atts").width);this.$el.attr("draggable",true).append('<div class="tailor-column__helper">'+'<div class="tailor-column__sizer"></div>'+"</div>")},onResize:function(e){var columnView=this;var model=columnView.model;var nextModel=model.collection.findWhere({parent:model.get("parent"),order:model.get("order")+1});var originalWidth=model.get("atts").width;function onResize(e){document.body.classList.add("is-resizing");document.body.style.cursor="col-resize";var rect=columnView.el.getBoundingClientRect();var atts=_.clone(model.get("atts"));var nextAtts=_.clone(nextModel.get("atts"));var width=parseInt(atts.width);var nextWidth=parseInt(nextAtts.width);var newWidth=Math.round((e.clientX-rect.left)/rect.width*width);if(newWidth<1||newWidth+1>width+nextWidth||newWidth==width){return}atts.width=newWidth;nextAtts.width=nextWidth-(newWidth-width);model.set("atts",atts,{silent:true});nextModel.set("atts",nextAtts,{silent:true});model.trigger("change:width",model,atts.width);nextModel.trigger("change:width",nextModel,nextAtts.width)}function onResizeEnd(e){document.removeEventListener("mousemove",onResize,false);document.removeEventListener("mouseup",onResizeEnd,false);document.body.classList.remove("is-resizing");document.body.style.cursor="default";if(originalWidth!=model.get("atts").width){app.channel.trigger("element:resize",model)}}document.addEventListener("mousemove",onResize,false);document.addEventListener("mouseup",onResizeEnd,false);app.channel.trigger("canvas:reset");return false},onChangeWidth:function(model,width){this.updateClassName(width);this.triggerAll("element:parent:change",this)},updateClassName:function(width){this.$el.removeClass(function(index,css){return(css.match(/(^|\s)columns-\S+/g)||[]).join(" ")});this.el.classList.add("columns-"+width)}});module.exports=ColumnView},{"./../view-container":27}],18:[function(require,module,exports){var ContainerView=require("./../view-container"),ListItemView;ListItemView=ContainerView.extend({childViewContainer:".tailor-list__content"});module.exports=ListItemView},{"./../view-container":27}],19:[function(require,module,exports){var ContainerView=require("./../view-container"),TabView;TabView=ContainerView.extend({onDomRefresh:function(){this.el.draggable=false;this.el.id=this.model.cid}});module.exports=TabView},{"./../view-container":27}],20:[function(require,module,exports){var ContainerView=require("./../view-container"),ToggleView;ToggleView=ContainerView.extend({childViewContainer:".tailor-toggle__body"});module.exports=ToggleView},{"./../view-container":27}],21:[function(require,module,exports){module.exports=Marionette.ItemView.extend({tagName:"li",attributes:function(){return{"data-id":this.model.cid}},getTemplate:function(){return _.template('<button data-role="none" role="button" aria-required="false" tabindex="0"></button>')}})},{}],22:[function(require,module,exports){module.exports=Marionette.CollectionView.extend({tagName:"ul",className:"slick-dots",childView:require("./navigation-carousel-item"),events:{dragstart:"onDragStart"},onDragStart:function(e){app.channel.trigger("canvas:reset");e.stopPropagation()},onRender:function(){var navigation=this;this.sortable=new Sortable(navigation.el,{draggable:"li",animation:150,onUpdate:function(e){var $container=navigation.$el.parent();$container.trigger("before:element:change:order");$container.trigger("element:change:order",[e.item.getAttribute("data-id"),e.newIndex,e.oldIndex]);app.channel.trigger("element:change:order",navigation.model)}})},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child,collection:this.collection},childViewOptions);return new ChildViewClass(options)},filter:function(child,index,collection){return child.get("parent")===this.model.get("id")},onBeforeDestroy:function(){this.sortable.destroy()}})},{"./navigation-carousel-item":21}],23:[function(require,module,exports){module.exports=Marionette.ItemView.extend({tagName:"li",className:function(){return"tailor-tabs__navigation-item tailor-"+this.model.get("id")},modelEvents:{"change:atts":"onChangeAttributes"},attributes:function(){return{"data-id":this.model.cid}},getTemplate:function(){return _.template('<%= title || "Tab" %>')},serializeData:function(){var data=Marionette.ItemView.prototype.serializeData.apply(this,arguments);var atts=this.model.get("atts");data.title=atts.title;return data},onChangeAttributes:function(model,atts){this.el.innerHTML=atts.title||"Tab"}})},{}],24:[function(require,module,exports){module.exports=Marionette.CollectionView.extend({childView:require("./navigation-tab"),events:{dragstart:"onDragStart"},onDragStart:function(e){app.channel.trigger("canvas:reset");
e.stopPropagation()},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child,collection:this.collection},childViewOptions);return new ChildViewClass(options)},filter:function(child,index,collection){return child.get("parent")===this.model.get("id")},onRender:function(){var navigation=this;this.sortable=new Sortable(navigation.el,{draggable:".tailor-tabs__navigation-item",animation:150,onUpdate:function(e){var $container=navigation.$el.parent();$container.trigger("before:element:change:order");$container.trigger("element:change:order",[e.item.getAttribute("data-id"),e.newIndex,e.oldIndex]);app.channel.trigger("element:change:order",navigation.model)}})},onBeforeDestroy:function(){this.sortable.destroy()}})},{"./navigation-tab":23}],25:[function(require,module,exports){var ContainerView=require("./../view-container"),CarouselView;CarouselView=ContainerView.extend({childViewContainer:".tailor-carousel__wrap",events:{"element:change:order":"onReorderElement"},onReorderElement:function(e,id,newIndex,oldIndex){if(newIndex-oldIndex<0){this.children.each(function(view){if(view._index>=newIndex&&view._index<=oldIndex){if(view._index==oldIndex){view._index=newIndex}else{view._index++}view.model.set("order",view._index)}},this)}else{this.children.each(function(view){if(view._index>=oldIndex&&view._index<=newIndex){if(view._index==oldIndex){view._index=newIndex}else{view._index--}view.model.set("order",view._index)}},this)}this.model.collection.sort()},onBeforeRenderTemplate:function(){if(this.navigation){this.navigation.triggerMethod("destroy")}},onRenderTemplate:function(){var NavigationView=require("./navigation/navigation-carousel");this.navigation=new NavigationView({model:this.model,collection:this.collection,sort:false});this.$el.append(this.navigation.render().el)},onBeforeDestroy:function(){this.triggerAll("before:element:destroy",this);this.navigation.triggerMethod("destroy")}});module.exports=CarouselView},{"./../view-container":27,"./navigation/navigation-carousel":22}],26:[function(require,module,exports){var ContainerView=require("./../view-container"),TabsView;TabsView=ContainerView.extend({ui:{navigation:".tailor-tabs__navigation"},childViewContainer:".tailor-tabs__content",events:{"element:change:order":"onReorderElement"},onReorderElement:function(e,id,newIndex,oldIndex){if(newIndex-oldIndex<0){this.children.each(function(view){if(view._index>=newIndex&&view._index<=oldIndex){if(view._index==oldIndex){view._index=newIndex}else{view._index++}view.model.set("order",view._index)}},this)}else{this.children.each(function(view){if(view._index>=oldIndex&&view._index<=newIndex){if(view._index==oldIndex){view._index=newIndex}else{view._index--}view.model.set("order",view._index)}},this)}this.model.collection.sort()},onBeforeRenderTemplate:function(){if(this.navigation){this.navigation.triggerMethod("destroy")}},onRenderTemplate:function(){var NavigationView=require("./navigation/navigation-tabs");this.navigation=new NavigationView({el:this.ui.navigation,model:this.model,collection:this.collection,sort:false});this.navigation.render()},childRefreshed:function(childView){childView.el.id=childView.model.cid;childView.el.classList.add("is-active");this.triggerAll("element:child:refresh",childView)},onBeforeDestroy:function(){this.triggerAll("before:element:destroy",this);this.navigation.triggerMethod("destroy")}});module.exports=TabsView},{"./../view-container":27,"./navigation/navigation-tabs":24}],27:[function(require,module,exports){var $=window.jQuery,CompositeView;CompositeView=Marionette.CompositeView.extend({behaviors:{Container:{},Draggable:{},Droppable:{},Editable:{},Movable:{}},initialize:function(){this._isReady=false;this._isBeingDestroyed=false;this.addEventListeners()},addEventListeners:function(){this.listenTo(app.channel,"before:elements:restore",this.onBeforeDestroy)},getChildView:function(child){return window.Tailor.Views.lookup(child.get("tag"),child.get("type"))},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child,collection:this.collection},childViewOptions);return new ChildViewClass(options)},filter:function(child,index,collection){return child.get("parent")===this.model.get("id")},attachElContent:function(html){var $el=jQuery(html);this.$el.replaceWith($el);this.setElement($el);this.el.setAttribute("draggable",true);return this},getTemplateId:function(){return"tmpl-tailor-"+this.model.get("id")},getTemplate:function(){var el=document.querySelector("#"+this.getTemplateId());var template;if(el){template=_.template(el.innerHTML);el.parentElement.removeChild(el)}else{el=document.querySelector("#tmpl-tailor-"+this.model.get("tag")+"-default");template=_.template(el.innerHTML)}return template},updateTemplate:function(html){var templateId=this.getTemplateId();var el=document.querySelector("#"+templateId);if(!el){el=document.createElement("script");el.setAttribute("type","text/html");el.id=templateId;document.body.appendChild(el)}el.innerHTML=html},renderTemplate:function(){this._ensureViewIsIntact();var $childViewContainer=this.getChildViewContainer(this);var $children=$childViewContainer.contents().detach();this.resetChildViewContainer();this._renderTemplate();$childViewContainer=this.getChildViewContainer(this);$childViewContainer.append($children);return this},_updateIndices:function(view,increment,index){if(increment){view._index=index;view.model._changing=false;view.model.set("order",index)}this.children.each(function(laterView){if(laterView._index>=view._index){laterView._index+=increment?1:-1;laterView.model.set("order",laterView._index)}},this)},onBeforeRender:function(){this.triggerAll("before:element:ready",this)},onDomRefresh:function(){this.el.setAttribute("draggable",true);this.$el.find("a").attr({target:"_blank",draggable:false});this.$el.find("img").attr("draggable","false")},onBeforeDestroy:function(){this.triggerAll("before:element:destroy",this)},onDestroy:function(){this.triggerAll("element:destroy",this)},modelEvents:{"change:atts":"onChangeAttributes","change:parent":"onChangeParent"},onChangeAttributes:function(model,atts){model=this.model.toJSON();model.atts=atts?atts:{};var compositeView=this;var options={data:{model:JSON.stringify(model),nonce:window._nonces.render},success:function(response){compositeView.updateTemplate(response.html);app.channel.trigger("css:update",compositeView.model.get("id"),response.css)},error:function(){compositeView.updateTemplate("The template for "+compositeView.cid+" could not be refreshed")},complete:function(){var isEditing=compositeView.$el.hasClass("is-editing");var isSelected=compositeView.$el.hasClass("is-selected");compositeView.$el.removeClass("is-rendering");compositeView.triggerAll("before:element:refresh",compositeView,model.atts);compositeView.renderTemplate();compositeView.triggerAll("element:refresh",compositeView,model.atts);compositeView.refreshChildren();if(isEditing){compositeView.$el.addClass("is-editing")}if(isSelected){compositeView.$el.addClass("is-selected")}}};compositeView.el.classList.add("is-rendering");window.ajax.send("tailor_render",options)},onChangeParent:function(){this.triggerAll("element:change:parent",this);this.refreshChildren()},childEvents:{"before:element:ready":"beforeChildElementReady","element:ready":"childElementReady","before:element:refresh":"beforeChildElementRefreshed","element:refresh":"childElementRefreshed","before:element:destroy":"beforeChildElementDestroyed","element:destroy":"childElementDestroyed"},beforeChildElementReady:function(childView){if(this._isReady){this.triggerAll("before:element:child:ready",childView)}},childElementReady:function(childView){if(!this._isReady){var readyChildren=this.children.filter(function(childView){return childView._isReady}).length;if(this.children.length==readyChildren){this._isReady=true;this.triggerAll("element:ready",this);this.refreshChildren()}}else{this.triggerAll("element:child:ready",childView)}},beforeChildElementRefreshed:function(childView){this.triggerAll("before:element:child:refresh",childView)},childElementRefreshed:function(childView){this.triggerAll("element:child:refresh",childView)},beforeChildElementDestroyed:function(childView){if(!this._isBeingDestroyed){this.triggerAll("before:element:child:destroy",childView)}},childElementDestroyed:function(childView){if(!this._isBeingDestroyed&&this.children.length>1){this.triggerAll("element:child:destroy",childView)}},onElementParentChange:function(){this.refreshChildren()},onElementChildDestroy:function(){this.refreshChildren()},events:{"element:parent:change":"stopEventPropagation","before:element:ready":"stopEventPropagation","element:ready":"stopEventPropagation","before:element:refresh":"stopEventPropagation","element:refresh":"stopEventPropagation","before:element:destroy":"stopEventPropagation","element:destroy":"stopEventPropagation","before:element:copy":"stopEventPropagation","element:copy":"stopEventPropagation","element:child:add":"onDescendantAdded","element:child:remove":"onDescendantRemoved","before:element:child:ready":"stopEventPropagation","element:child:ready":"onDescendantReady","before:element:child:refresh":"stopEventPropagation","element:child:refresh":"stopEventPropagation","before:element:child:destroy":"stopEventPropagation","element:child:destroy":"onDescendantDestroyed"},onDescendantAdded:function(e,descendantView){if(!this._isReady){var readyChildren=this.children.filter(function(childView){return childView._isReady}).length;if(this.children.length==readyChildren){this._isReady=true;this.triggerAll("element:ready",this)}e.stopImmediatePropagation()}else{this.triggerAll("element:descendant:add",descendantView);e.stopPropagation()}},onDescendantRemoved:function(e,descendantView){if("container"==this.model.get("type")&&this.children.length>1||this.children.length>0){this.triggerAll("element:descendant:remove",descendantView)}e.stopPropagation()},onDescendantReady:function(e,descendantView){if(!this._isReady){if(this.children.length==1&&this.children.contains(descendantView)){this._isReady=true;this.triggerAll("element:ready",this)}e.stopImmediatePropagation()}else{this.triggerAll("element:descendant:add",descendantView);this.refreshChildren();e.stopPropagation()}},onDescendantDestroyed:function(e,descendantView){if("container"==this.model.get("type")&&this.children.length>1||this.children.length>0){this.triggerAll("element:descendant:destroy",descendantView)}e.stopPropagation()},refreshChildren:function(){this.children.each(function(childView){childView.triggerAll("element:parent:change",childView)},this)},triggerAll:function(event,view,atts){this.$el.trigger(event,view);this.triggerMethod(event,view);if(atts){app.channel.trigger(event,this,atts)}else{app.channel.trigger(event,this)}},stopEventPropagation:function(e){e.stopPropagation()}});module.exports=CompositeView},{}],28:[function(require,module,exports){var $=window.jQuery,ElementView;ElementView=Marionette.ItemView.extend({className:"element",attributes:{draggable:true},behaviors:{Draggable:{},Droppable:{},Editable:{},Movable:{}},modelEvents:{"change:atts":"onChangeAttributes","change:parent":"onChangeParent"},initialize:function(){this._isReady=false;this._isBeingDestroyed=false;this.addEventListeners()},addEventListeners:function(){this.listenTo(app.channel,"before:elements:restore",this.onBeforeDestroy)},getTemplateId:function(){return"tmpl-tailor-"+this.model.get("id")},getTemplate:function(){var el=document.querySelector("#"+this.getTemplateId());var template;if(el){template=_.template(el.innerHTML);el.parentElement.removeChild(el)}else{el=document.querySelector("#tmpl-tailor-"+this.model.get("tag")+"-default");template=_.template(el.innerHTML)}return template},attachElContent:function(html){var $el=$(html);this.$el.replaceWith($el);this.setElement($el);this.el.setAttribute("draggable",true);return this},updateTemplate:function(html){var templateId=this.getTemplateId();var el=document.querySelector("#"+templateId);if(!el){el=document.createElement("script");el.setAttribute("type","text/html");el.id=templateId;document.body.appendChild(el)}el.innerHTML=html},onChangeAttributes:function(model,atts){var itemView=this;model=this.model.toJSON();if(atts){model.atts=atts}var options={data:{model:JSON.stringify(model),nonce:window._nonces.render},success:function(response){itemView.updateTemplate(response.html);app.channel.trigger("css:update",itemView.model.get("id"),response.css)},error:function(response){itemView.updateTemplate("The template for "+itemView.cid+" could not be refreshed")},complete:function(){var isEditing=itemView.$el.hasClass("is-editing");var isSelected=itemView.$el.hasClass("is-selected");itemView.$el.removeClass("is-rendering");itemView.triggerAll("before:element:refresh",itemView,model.atts);itemView.render();itemView.triggerAll("element:refresh",itemView,model.atts);if(isEditing){itemView.$el.addClass("is-editing")}if(isSelected){itemView.$el.addClass("is-selected")}}};itemView.el.classList.add("is-rendering");window.ajax.send("tailor_render",options)},onChangeParent:function(){this.triggerAll("element:change:parent",this)},onBeforeRender:function(){this.triggerAll("before:element:ready",this)},onDomRefresh:function(){var elementView=this;this.el.setAttribute("draggable",true);this.$el.find("a").attr({target:"_blank",draggable:false});this.$el.find("img").attr("draggable","false");this.$el.imagesLoaded(function(){elementView._isReady=true;elementView.triggerAll("element:ready",elementView)})},onBeforeDestroy:function(){this.triggerAll("before:element:destroy",this)},onDestroy:function(){this.triggerAll("element:destroy",this)},triggerAll:function(event,view,atts){this.$el.trigger(event,view);this.triggerMethod(event,view);if(atts){app.channel.trigger(event,this,atts)}else{app.channel.trigger(event,this)}}});module.exports=ElementView},{}],29:[function(require,module,exports){var ContainerView=require("./../view-container"),BoxView;BoxView=ContainerView.extend({childViewContainer:".tailor-box__content"});module.exports=BoxView},{"./../view-container":27}],30:[function(require,module,exports){var ContainerView=require("./../view-container"),CardView;CardView=ContainerView.extend({childViewContainer:".tailor-card__content"});module.exports=CardView},{"./../view-container":27}],31:[function(require,module,exports){var ContainerView=require("./../view-container"),HeroView;HeroView=ContainerView.extend({childViewContainer:".tailor-hero__content"});module.exports=HeroView},{"./../view-container":27}],32:[function(require,module,exports){var ContainerView=require("./../view-container"),SectionView;SectionView=ContainerView.extend({attributes:{draggable:true},modelEvents:{"change:atts":"onChangeAttributes"},childViewContainer:".tailor-section__content"});module.exports=SectionView},{"./../view-container":27}],33:[function(require,module,exports){var $=window.jQuery,Lightbox;Lightbox=function(el,options,callbacks){this.el=el;this.$el=$(el);this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Lightbox.prototype={defaults:{type:"image",delegate:".is-lightbox-image",closeMarkup:'<button title="%title%" type="button" class="not-a-button mfp-close">&#215;</button>',gallery:{enabled:true,arrowMarkup:'<button title="%title%" type="button" class="not-a-button mfp-arrow mfp-arrow-%dir%"></button>'},image:{titleSrc:function(item){return item.el.find("figcaption").text()}}},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.magnificPopup();this.addEventListeners();if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:destroy",$.proxy(this.destroy,this))},magnificPopup:function(){this.$el.magnificPopup(this.options)},destroy:function(e){if(e.target!=this.el){return}this.$el.off();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorLightbox=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorLightbox");if(!instance){$.data(this,"tailorLightbox",new Lightbox(this,options,callbacks))}})}},{}],34:[function(require,module,exports){var $=window.jQuery,Map;Map=function(el,options,callbacks){this.el=el;this.$el=$(el);this.$win=$(window);this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Map.prototype={defaults:{height:450,address:"",latitude:"",longitude:"",zoom:12,draggable:1,scrollwheel:0,controls:0,hue:null,saturation:0},callbacks:{onInitialize:function(){},onDestroy:function(){}},getStyles:function(saturation,hue){return[{featureType:"all",elementType:"all",stylers:[{saturation:saturation?saturation:null},{hue:hue?hue:null}]},{featureType:"water",elementType:"all",stylers:[{hue:hue?hue:null},{saturation:saturation?saturation:null},{lightness:50}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"simplified"}]}]},initialize:function(){var map=this;this.markers=[];this.infoWindows=[];this.$canvas=this.$el.find(".tailor-map__canvas").height(this.options.height);this.getCoordinates(this.options).then(function(coordinates){map.center=coordinates;var controls=map.options.controls;var settings={zoom:map.options.zoom,draggable:map.options.draggable,scrollwheel:map.options.scrollwheel,center:coordinates,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!controls,panControl:controls,rotateControl:controls,scaleControl:controls,zoomControl:controls,mapTypeControl:controls,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_CENTER}};var styles=map.getStyles(map.options.saturation,map.options.hue);map.map=new google.maps.Map(map.$canvas[0],settings);map.map.mapTypes.set("map_style",new google.maps.StyledMapType(styles,{name:"Styled Map"}));map.map.setMapTypeId("map_style");map.setupMarkers(map.$el,map.map);map.addEventListeners();if("function"==typeof map.callbacks.onInitialize){map.callbacks.onInitialize.call(map)}})},addEventListeners:function(){this.$el.on("element:change:parent",$.proxy(this.refresh,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:parent:change",$.proxy(this.refresh,this));this.$win.on("resize",$.proxy(this.refresh,this))},maybeRefresh:function(e){if(e.target==this.el){this.refresh()}},refresh:function(){google.maps.event.trigger(this.map,"resize");this.map.setCenter(this.center)},maybeDestroy:function(e){if(e.target==this.el){this.destroy()}},getCoordinates:function(options){return $.Deferred(function(deferred){if("undefined"==typeof google){deferred.reject(new Error("The Google Maps API is currently unavailable"))}else if(""!=options.address){var geocoder=new google.maps.Geocoder;geocoder.geocode({address:options.address},function(results,status){if(google.maps.GeocoderStatus.OK==status){deferred.resolve(results[0].geometry.location)}else if(options.latitude&&options.longitude){deferred.resolve(new google.maps.LatLng(options.latitude,options.longitude))}else{deferred.reject(new Error(status))}})}else if(options.latitude&&options.longitude){deferred.resolve(new google.maps.LatLng(options.latitude,options.longitude))}else{deferred.reject(new Error("No address or map coordinates provided"))}}).promise()},setupMarkers:function($el,googleMap){var map=this;this.$el.find(".tailor-map__marker").each(function(index,el){var defaults={address:"",latitude:"",longitude:"",image:""};var settings=_.extend({},defaults,$(el).data());map.getCoordinates(settings).then(function(coordinates){map.markers[index]=new google.maps.Marker({map:googleMap,position:coordinates,infoWindowIndex:index,icon:settings.image});if("null"!=el.innerHTML){map.infoWindows[index]=new google.maps.InfoWindow({content:el.innerHTML});google.maps.event.addListener(map.markers[index],"click",function(){if(el.innerHTML){map.infoWindows[index].open(googleMap,this)}})}})})},destroy:function(){delete this.map;delete this.markers;delete this.infoWindows;this.$el.off();this.$win.off("resize",$.proxy(this.refresh,this));if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorGoogleMap=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorGoogleMap");if(!instance){$.data(this,"tailorGoogleMap",new Map(this,options,callbacks))}})};module.exports=Map},{}],35:[function(require,module,exports){var $=window.jQuery,Masonry;Masonry=function(el,options,callbacks){this.el=el;this.$el=$(el);this.$wrap=this.$el.find(".tailor-grid--masonry");this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Masonry.prototype={defaults:{itemSelector:".tailor-grid__item"},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.shuffle();if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:refresh",$.proxy(this.maybeDestroy,this)).on("element:change:parent",$.proxy(this.refreshShuffle,this)).on("before:element:copy",$.proxy(this.maybeUnShuffle,this)).on("element:copy",$.proxy(this.maybeShuffle,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:parent:change",$.proxy(this.refreshShuffle,this))},maybeShuffle:function(e){if(e.target==this.el){this.shuffle()}},maybeRefreshShuffle:function(e){if(e.target==this.el){this.refreshShuffle()}},maybeUnShuffle:function(e){if(e.target==this.el){this.unShuffle()}},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},shuffle:function(){var masonry=this;this.$wrap.imagesLoaded(function(){masonry.$wrap.shuffle(masonry.options);masonry.addEventListeners()})},refreshShuffle:function(){this.$wrap.shuffle("update")},unShuffle:function(){this.$wrap.shuffle("destroy")},destroy:function(e){this.unShuffle();this.$el.off();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorMasonry=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorMasonry");if(!instance){$.data(this,"tailorMasonry",new Masonry(this,options,callbacks))}})}},{}],36:[function(require,module,exports){var $=window.jQuery,Slideshow;Slideshow=function(el,options,callbacks){this.el=el;this.$el=$(el);this.$wrap=this.$el.find(".tailor-slideshow__slides");this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Slideshow.prototype={defaults:{items:".tailor-slideshow__slide",prevArrow:'<button type="button" data-role="none" class="lick-prev" aria-label="Previous" tabindex="0" role="button"></button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button"></button>',adaptiveHeight:true,draggable:false,speed:250,slidesToShow:1,slidesToScroll:1,autoplay:false,arrows:false,dots:false,fade:true},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.slick();if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:refresh",$.proxy(this.unSlick,this)).on("element:change:parent",$.proxy(this.maybeRefreshSlick,this)).on("before:element:copy",$.proxy(this.unSlick,this)).on("element:copy",$.proxy(this.slick,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:parent:change",$.proxy(this.maybeRefreshSlick,this))},maybeSlick:function(e){if(e.target==this.el){this.slick()}},maybeRefreshSlick:function(e){if(e.target==this.el){this.refreshSlick()}},maybeUnSlick:function(e){if(e.target==this.el){this.unSlick()}},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},slick:function(){var slideshow=this;this.$el.imagesLoaded(function(){slideshow.addEventListeners();slideshow.$wrap.slick(slideshow.options)})},refreshSlick:function(){this.$wrap.slick("refresh")},unSlick:function(){this.$wrap.slick("unslick")},destroy:function(e){this.$el.off();this.unSlick();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorSlideshow=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorSlideshow");if(!instance){$.data(this,"tailorSlideshow",new Slideshow(this,options,callbacks))}})}},{}],37:[function(require,module,exports){var $=window.jQuery,Tabs;Tabs=function(el,options,callbacks){this.el=el;this.$el=$(el);this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Tabs.prototype={defaults:{tabs:".tailor-tabs__navigation .tailor-tabs__navigation-item",content:".tailor-tabs__content .tailor-tab",initial:1},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.querySelectors();this.setActive();this.addEventListeners();if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:refresh",$.proxy(this.maybeDestroy,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:child:add element:child:ready",$.proxy(this.onChangeChild,this)).on("element:child:refresh",$.proxy(this.onChangeChild,this)).on("element:child:destroy",$.proxy(this.onDestroyChild,this)).on("element:change:order",$.proxy(this.onReorderChild,this))},querySelectors:function(){if(this.$tabs){this.$tabs.off()}this.$content=this.$el.find(this.options.content);this.$tabs=this.$el.find(this.options.tabs).on("click",$.proxy(this.onClick,this))},setActive:function(){var active=this.$content.filter(function(){return this.classList.contains("is-active")});var el;if(0==active.length){var initial=this.options.initial-1;if(this.$content[initial]){el=this.$content[initial]}}else{el=active[0]}if(el){this.activate(el.id)}},onClick:function(e){this.activate(e.target.getAttribute("data-id"));e.preventDefault()},onChangeChild:function(e,childView){if(e.target==this.el){this.querySelectors();this.activate(childView.el.id)}},onReorderChild:function(e,id,newIndex,oldIndex){if(e.target==this.el){var $item=this.$content.filter(function(){return this.id==id});if(oldIndex-newIndex<0){$item.insertAfter(this.$content[newIndex])}else{$item.insertBefore(this.$content[newIndex])}this.activate(id)}},onDestroyChild:function(e,childView){if(e.target!==this.el){return}if(0==childView.$el.index()&&!childView.el.nextSibling){return}var id=childView.el.nextSibling?childView.el.nextSibling.id:childView.el.previousSibling.id;childView.$el.remove();this.querySelectors();this.activate(id)},activate:function(id){this.$tabs.each(function(){this.classList.toggle("is-active",this.getAttribute("data-id")==id)});this.$content.each(function(){$(this).toggle(this.id==id).toggleClass("is-active",this.id==id).children().each(function(index,el){var $el=$(el);$el.trigger("element:parent:change",$el)})})},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},destroy:function(e){this.$el.off();this.$tabs.off();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorTabs=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorTabs");if(!instance){$.data(this,"tailorTabs",new Tabs(this,options,callbacks))}})};module.exports=Tabs},{}],38:[function(require,module,exports){var $=window.jQuery,Toggles;Toggles=function(el,options,callbacks){this.el=el;this.$el=$(el);this.options=$.extend({},this.defaults,this.$el.data(),options);this.callbacks=$.extend({},this.callbacks,callbacks);this.initialize()};Toggles.prototype={defaults:{toggles:".tailor-toggle__title",content:".tailor-toggle__body",accordion:false,initial:-1,speed:150},callbacks:{onInitialize:function(){},onDestroy:function(){}},initialize:function(){this.querySelectors();this.addEventListeners();var initial=this.options.initial-1;if(this.$toggles[initial]){this.activate(this.$toggles[initial])}if("function"==typeof this.callbacks.onInitialize){this.callbacks.onInitialize.call(this)}},addEventListeners:function(){this.$el.on("before:element:refresh",$.proxy(this.maybeDestroy,this)).on("before:element:destroy",$.proxy(this.maybeDestroy,this)).on("element:child:add element:child:ready",$.proxy(this.onChangeChild,this)).on("element:child:refresh",$.proxy(this.onChangeChild,this)).on("element:child:destroy",$.proxy(this.onChangeChild,this))},querySelectors:function(){this.$content=this.$el.find(this.options.content);this.$toggles=this.$el.find(this.options.toggles).off().on("click",$.proxy(this.onClick,this))},onClick:function(e){this.activate(e.target);e.preventDefault()},onChangeChild:function(e,childView){if(e.target==this.el){this.querySelectors()}},activate:function(el){var speed=this.options.speed;var $el=$(el);if(this.options.accordion){this.$toggles.filter(function(){return this!==el}).removeClass("is-active");this.$content.each(function(){var $toggle=$(this);if(el.nextElementSibling==this){$toggle.slideToggle(speed).children().each(function(index,el){var $el=$(el);$el.trigger("element:parent:change",$el)})}else{$toggle.slideUp(speed)}})}else{this.$content.filter(function(){return el.nextElementSibling==this}).slideToggle(speed).each(function(){$(this).children().each(function(index,el){var $el=$(el);$el.trigger("element:parent:change",$el)})})}$el.toggleClass("is-active")},maybeDestroy:function(e){if(e.target==this.el){this.destroy(e)}},destroy:function(e){this.$el.off();this.$toggles.off();if("function"==typeof this.callbacks.onDestroy){this.callbacks.onDestroy.call(this)}}};$.fn.tailorToggles=function(options,callbacks){return this.each(function(){var instance=$.data(this,"tailorToggles");if(!instance){$.data(this,"tailorToggles",new Toggles(this,options,callbacks))}})};module.exports=Toggles},{}],39:[function(require,module,exports){Tailor.Collections=Tailor.Collections||{};Tailor.Collections.Element=require("./collections/elements");Tailor.Collections.History=require("./collections/history");module.exports=Marionette.Module.extend({onBeforeStart:function(options){var module=this;var api={getElements:function(id){return id?module.elementCollection.findWhere({id:id}):module.elementCollection},getHistory:function(id){return id?module.historyCollection.findWhere({id:id}):module.historyCollection},resetElements:function(models){if(models===module.elementCollection.models){return}var canvas=document.getElementById("canvas");var templates;canvas.classList.add("is-loading");var options={data:{models:JSON.stringify(models),nonce:window._nonces.reset},success:function(response){models=response.models;templates=response.templates;app.channel.trigger("css:clear");app.channel.trigger("css:add",response.css)},complete:function(response){if(templates){jQuery("body").append(templates);app.channel.trigger("before:elements:restore");app.channel.trigger("canvas:reset");module.elementCollection.reset(null);module.elementCollection.reset(models);app.channel.trigger("elements:restore")}canvas.classList.remove("is-loading")}};window.ajax.send("tailor_reset",options)},loadTemplate:function(model,parent,index){var canvas=document.getElementById("canvas");var models;var templates;canvas.classList.add("is-loading");var options={data:{template_id:model.get("id"),nonce:window._nonces.loadTemplate},success:function(response){models=response.models;templates=response.templates;jQuery("body").append(templates);app.channel.trigger("css:add",response.css)},complete:function(response){if(templates){var parents=[];var children=[];_.each(models,function(model){if(""==model.parent){parents.push(model)}else{children.push(model)}});module.elementCollection.add(children,{silent:true});if(parents.length>1){module.elementCollection.add(parents,{
at:index+1})}else{parents[0].parent=parent;parents[0].order=index;module.elementCollection.add(parents)}}app.channel.trigger("template:add",model);canvas.classList.remove("is-loading")}};window.ajax.send("tailor_load_template",options)}};app.channel.reply("canvas:elements",api.getElements);app.channel.reply("sidebar:history",api.getHistory);app.channel.on("elements:reset",api.resetElements);app.channel.on("template:load",api.loadTemplate);this.elementCollection=new Tailor.Collections.Element(options.elements,{silent:false});this.historyCollection=new Tailor.Collections.History;this.l10n=options.l10n},onStart:function(options){this.addEventListeners()},addEventListeners:function(){this.listenTo(this.elementCollection,"change:atts",this.onEditAttributes);this.listenTo(app.channel,"element:add",this.onAddElement);this.listenTo(app.channel,"element:copy",this.onCopyElement);this.listenTo(app.channel,"element:move",this.onMoveElement);this.listenTo(app.channel,"element:edit",this.onEditElement);this.listenTo(app.channel,"element:delete",this.onDeleteElement);this.listenTo(app.channel,"element:resize",this.onResizeElement);this.listenTo(app.channel,"element:change:order",this.onReorderElement);this.listenTo(app.channel,"template:add",this.onAddTemplate);this.listenTo(app.channel,"history:restore",this.restoreSnapshot);this.listenTo(app.channel,"history:undo",this.undoStep);this.listenTo(app.channel,"history:redo",this.redoStep)},onEditAttributes:function(model,atts){if(model.previous("atts")===model.get("atts")){return}app.channel.trigger("element:edit",model)},onAddElement:function(model){this.saveSnapshot(this.l10n.added+" "+model.get("label"))},onEditElement:function(model){this.saveSnapshot(this.l10n.edited+" "+model.get("label"))},onCopyElement:function(model){this.saveSnapshot(this.l10n.copied+" "+model.get("label"))},onMoveElement:function(model){this.saveSnapshot(this.l10n.moved+" "+model.get("label"))},onDeleteElement:function(model){this.saveSnapshot(this.l10n.deleted+" "+model.get("label"))},onResizeElement:function(model){this.saveSnapshot(this.l10n.resized+" "+model.get("label"))},onReorderElement:function(model){this.saveSnapshot(this.l10n.reordered+" "+model.get("label"))},onAddTemplate:function(model){this.saveSnapshot(this.l10n.added+" "+this.l10n.template+" - "+model.get("label"))},saveSnapshot:function(label){this.historyCollection.save(label)},restoreSnapshot:function(timestamp){this.historyCollection.restore(timestamp)},undoStep:function(){this.historyCollection.undo()},redoStep:function(){this.historyCollection.redo()}})},{"./collections/elements":40,"./collections/history":41}],40:[function(require,module,exports){var $=Backbone.$,ElementCollection;ElementCollection=Backbone.Collection.extend({comparator:"order",model:function(attrs,options){var Model=window.Tailor.Models.lookup(attrs.tag,attrs.type);return new Model(attrs,options)},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"change:parent",this.onChangeParent);this.listenTo(this,"add",this.onAdd);this.listenTo(this,"destroy",this.onDestroy);this.listenTo(this,"container:collapse",this.onCollapse);this.listenTo(this,"reset",this.onReset)},getParent:function(model){return this.findWhere({id:model.get("parent")})},getChildren:function(model){return this.where({parent:model.get("id")})},getSiblings:function(model){return this.where({parent:model.get("parent")})},hasSelectedParent:function(model){var selected=app.channel.request("canvas:element:selected");if(!selected||model===selected){return false}var parentId=model.get("parent");var parent=this.findWhere({id:parentId});while("undefined"!==typeof parent){if(selected===parent){return true}parentId=parent.get("parent");parent=this.get(parentId)}return false},onChangeParent:function(model){var parent=this.get(model.get("parent"));var previousParent=this.get(model.previous("parent"));this.sort({silent:true});this._checkParent(previousParent);if("tailor_column"===model.get("tag")){this._reBalanceColumns(parent);this._reBalanceColumns(previousParent)}},onAdd:function(model,collection,options){if("tailor_column"==model.get("tag")&&options.rebalance){this._reBalanceColumns(this.get(model.get("parent")))}},onDestroy:function(model){var parent=this.get(model.get("parent"));this._checkParent(parent);var children=this.where({parent:model.get("id")});if(children.length){_.each(children,function(child){child.trigger("destroy",child,this)},this)}if(parent&&"tailor_column"===model.get("tag")){this._reBalanceColumns(parent)}if(0===this.length){this.onEmpty()}},onReset:function(){if(0===this.length){this.onEmpty()}},onEmpty:function(){var section=this.createSection(0);this.create([{tag:"tailor_content",atts:{},parent:section.get("id"),order:0}])},onCollapse:function(model,children){var parentId=model.get("parent");_.each(children,function(child){child.set("parent",parentId)},this)},_reBalanceColumns:function(model){var children=this.where({parent:model.get("id")});var numberChildren=children.length;_.each(children,function(child){var atts=_.clone(child.get("atts"));atts.width=12/numberChildren;child.set("atts",atts,{silent:true});child.trigger("change:width",model,atts.width)},this)},_checkParent:function(model){if(!model){return}if("container"==model.get("type")){this._checkCollapsibleContainer(model)}this._checkChildren(model)},_checkCollapsibleContainer:function(model){var childTag=this.getLibrary().findWhere({tag:model.get("tag")}).get("child");var containerId=model.get("id");var children=this.filter(function(element){return containerId===element.get("parent")&&childTag===element.get("tag")});if(0===children.length){model.trigger("container:collapse",model,this.where({parent:containerId}))}else if(1===children.length){var child=_.first(children);child.trigger("container:collapse",child,this.where({parent:child.get("id")}))}},_checkChildren:function(model){var children=this.where({parent:model.get("id")});if(0===children.length){model.trigger("destroy",model)}},create:function(models,options){options=options||{};if(_.isArray(models)){models=_.each(models,this.applyDefaults,this)}else{models=this.applyDefaults(models)}return this.add(models,options)},getLibrary:function(){return this.library||app.channel.request("sidebar:library")},applyDefaults:function(model){var item=this.getLibrary().findWhere({tag:model.tag});var label=item.get("label");var defaults={label:item.get("label"),type:item.get("type"),child:item.get("child")};model.atts=model.atts||{};_.each(item.get("settings"),function(setting){model.atts[setting["id"]]=model.atts[setting["id"]]||setting["value"]},this);return _.extend(model,defaults)},createSection:function(order){return _.first(this.create([{tag:"tailor_section",label:this.getLibrary().findWhere({tag:"tailor_section"}).get("label"),order:order}],{at:order}))},createRow:function(parentId,order){var row=_.first(this.create([{tag:"tailor_row",parent:parentId,order:order}],{}));return this.create([{tag:"tailor_column",atts:{width:6},parent:row.get("id"),order:0},{tag:"tailor_column",atts:{width:6},parent:row.get("id"),order:1}])},createColumn:function(parentId,order){var columns=this.where({parent:parentId});var column=_.first(this.create([{tag:"tailor_column",atts:{width:12/(columns.length+1)},parent:parentId,order:order}],{rebalance:true}));return column},insertChild:function(child,parent){if(!child){return}if(child.get("parent")!==parent.get("id")){child.trigger("remove:child")}parent.trigger("insert",child);child.trigger("add:child");child.set("parent",parent.get("id"))},createContainer:function(model,parentId,order,descendants){var tag=model.get("tag");var container=_.first(this.create([{tag:tag,parent:parentId,order:order}],{at:order,silent:true}));var childTag=model.get("child");var childLabel=this.getLibrary().findWhere({tag:childTag}).get("label");var children=this.create([{tag:childTag,label:childLabel,atts:{},parent:container.get("id"),order:0},{tag:childTag,label:childLabel,atts:{},parent:container.get("id"),order:1}],{silent:true});if(descendants){_.first(descendants).set("parent",_.first(children).get("id"),{silent:true});_.last(descendants).set("parent",_.last(children).get("id"),{silent:true})}this.trigger("add",container,this,{})},createWrapper:function(tag,parentId,order,child){var wrapper=_.first(this.create([{tag:tag,parent:parentId,order:order}],{silent:true}));if("undefined"==typeof child){this.create([{tag:"tailor_content",atts:{},parent:wrapper.get("id"),order:0}],{silent:true})}this.trigger("add",wrapper,this,{});if("undefined"!=typeof child){this.insertChild(child,wrapper)}return wrapper}});module.exports=ElementCollection},{}],41:[function(require,module,exports){var $=Backbone.$,HistoryCollection;HistoryCollection=Backbone.Collection.extend({maxSize:50,active:null,comparator:function(model){return-model.get("timestamp")},initialize:function(){this.elements=app.channel.request("canvas:elements");this.addEventListeners();this.save(window._l10n.initialized)},addEventListeners:function(){this.listenTo(this,"add",this.checkLength)},save:function(label){if(this.active){var activePosition=this.indexOf(this.active);if(activePosition>0){this.remove(this.slice(0,activePosition))}}var entry=this.add({label:label||"",elements:this.elements?this.elements.toJSON():[],time:this.getTime(),timestamp:_.now()});this.setActive(entry)},getTime:function(){var date=new Date;var hours=date.getHours();var separator=":";var suffix;if(hours>12){hours-=12;suffix=" PM"}else{suffix=" AM"}return hours+separator+("0"+date.getMinutes()).slice(-2)+separator+("0"+date.getSeconds()).slice(-2)+suffix},restore:function(timestamp){var entry=this.findWhere({timestamp:timestamp});if(!entry||entry===this.getActive()){return}this.setActive(entry);var elements=entry.get("elements");app.channel.trigger("elements:reset",elements)},undo:function(){if(!this.length){return}var entry=this.at(this.indexOf(this.getActive())+1);if(entry){this.restore(entry.get("timestamp"))}},redo:function(){if(!this.length){return}var entry=this.at(this.indexOf(this.getActive())-1);if(entry){this.restore(entry.get("timestamp"))}},checkLength:function(){if(this.length>this.maxSize){this.pop()}},setActive:function(model){this.active=model;this.trigger("change:active",model)},getActive:function(){return this.active}});module.exports=HistoryCollection},{}],42:[function(require,module,exports){var $=Backbone.$,ChildModel=require("./../model-child"),ColumnModel;ColumnModel=ChildModel.extend({validTarget:function(that,region){if(_.contains(["tailor_section","tailor_row"],that.get("tag"))||!_.contains(["left","right"],region)){return false}if("child"==that.get("type")&&that.get("tag")!=this.get("tag")){return false}var siblings=this.collection.getSiblings(this);return that.get("parent")==this.get("parent")||siblings.length<4}});module.exports=ColumnModel},{"./../model-child":49}],43:[function(require,module,exports){var $=Backbone.$,ChildModel=require("./../model-child"),GridItemModel;GridItemModel=ChildModel.extend({validTarget:function(that,region){if("tailor_section"==that.get("tag")||_.contains(["top","bottom","center"],region)){return false}var parent=this.collection.getParent(this);if(parent.get("tag")==that.get("tag")){return false}return that.get("tag")==this.get("tag")}});module.exports=GridItemModel},{"./../model-child":49}],44:[function(require,module,exports){var $=Backbone.$,ContainerModel=require("./../model-container"),CarouselModel;CarouselModel=ContainerModel.extend({createTemplate:function(id,view){var isEditing=view.el.classList.contains("is-editing");this.beforeCopyElement(view);var $childViewContainer=view.getChildViewContainer(view);var $children=$childViewContainer.contents().detach();var $navigation=view.$el.find(".slick-dots").detach();this.appendTemplate(id,view);$childViewContainer.append($children);$navigation.insertAfter($childViewContainer);this.afterCopyElement(id,view);if(isEditing){view.el.classList.add("is-editing")}}});module.exports=CarouselModel},{"./../model-container":51}],45:[function(require,module,exports){var $=Backbone.$,ContainerModel=require("./../model-container"),RowModel;RowModel=ContainerModel.extend({validTarget:function(that,region){if("child"==that.get("type")||"tailor_section"==that.get("tag")||"center"==region){return false}return _.contains(["top","bottom"],region)&&"tailor_column"!=that.get("tag")}});module.exports=RowModel},{"./../model-container":51}],46:[function(require,module,exports){var $=Backbone.$,ContainerModel=require("./../model-container"),TabsModel;TabsModel=ContainerModel.extend({createTemplate:function(id,view){var isEditing=view.el.classList.contains("is-editing");this.beforeCopyElement(view);var $childViewContainer=view.getChildViewContainer(view);var $children=$childViewContainer.contents().detach();var $navigation=view.$el.find(".tailor-tabs__navigation");var $navigationItems=$navigation.children().detach();this.appendTemplate(id,view);$childViewContainer.append($children);$navigation.append($navigationItems);this.afterCopyElement(id,view);if(isEditing){view.el.classList.add("is-editing")}}});module.exports=TabsModel},{"./../model-container":51}],47:[function(require,module,exports){var $=Backbone.$,BaseModel=require("./model-base"),ElementModel;ElementModel=BaseModel.extend({validTarget:function(that,region){if("child"==that.get("type")||_.contains(["tailor_section","tailor_column"],that.get("tag"))||"center"==region){return false}var parent=this.collection.getParent(this);if("tailor_row"==that.get("tag")){return"tailor_section"==parent.get("tag")&&_.contains(["top","bottom"],region)}if("child"==parent.get("type")&&"tailor_column"!=parent.get("tag")){return"container"!=that.get("type")&&!_.contains(["left","right"],region)}if(_.contains(["wrapper","child"],parent.get("type"))){if(_.contains(["top","bottom"],region)){return _.contains(["tailor_section","tailor_column"],parent.get("tag"))||!_.contains(["container","wrapper","child"],that.get("type"))}return"tailor_section"==parent.get("tag")||!_.contains(["left","right"],region)}return true},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:move:top",this.insertBefore);this.listenTo(this,"element:move:bottom",this.insertAfter);this.listenTo(this,"element:move:left",this.columnBefore);this.listenTo(this,"element:move:right",this.columnAfter);this.listenTo(this,"element:copy:top",this.copyBefore);this.listenTo(this,"element:copy:bottom",this.copyAfter);this.listenTo(this,"element:copy:left",this.copyColumnBefore);this.listenTo(this,"element:copy:right",this.copyColumnAfter);this.listenTo(this,"element:move:center",this.createChild);this.listenTo(this,"element:copy:center",this.copyChild)},copyBefore:function(targetView,sourceView){var clone=sourceView.model.clone();var index=targetView.model.get("order")-1;clone.set("id",clone.cid);clone.set("parent",targetView.model.get("parent"));clone.set("order",index);this.createTemplate(clone.cid,sourceView);this.collection.add(clone)},copyAfter:function(targetView,sourceView){var clone=sourceView.model.clone();var index=targetView.model.get("order");clone.set("id",clone.cid);clone.set("parent",targetView.model.get("parent"));clone.set("order",index);this.createTemplate(clone.cid,sourceView);this.collection.add(clone)},copyColumnBefore:function(targetView,sourceView){var model=targetView.model;var clone=sourceView.model.clone();clone.set("id",clone.cid);this.createTemplate(clone.cid,sourceView);if("tailor_column"===model.get("tag")){var column=this.collection.createColumn(model.get("parent"),model.get("order")-1);clone.set("parent",column.get("id"));this.collection.add(clone)}else{var columns=this.collection.createRow(model.get("parent"),model.get("order"));this.collection.insertChild(model,_.last(columns));clone.set("parent",_.first(columns).get("id"));this.collection.add(clone)}},copyColumnAfter:function(targetView,sourceView){var model=targetView.model;var clone=sourceView.model.clone();clone.set("id",clone.cid);this.createTemplate(clone.cid,sourceView);if("tailor_column"===model.get("tag")){var column=this.collection.createColumn(model.get("parent"),model.get("order"));clone.set("parent",column.get("id"));this.collection.add(clone)}else{var columns=this.collection.createRow(model.get("parent"),model.get("order"));this.collection.insertChild(model,_.first(columns));clone.set("parent",_.last(columns).get("id"));this.collection.add(clone)}},createChild:function(targetView,sourceView){var id=targetView.model.get("id");var childTag=targetView.model.get("child");var numberChildren=this.collection.where({parent:id,tag:childTag}).length;this.appendTemplate(sourceView.model.get("id"),sourceView);this.collection.createWrapper(childTag,id,numberChildren,sourceView.model)},copyChild:function(targetView,sourceView){var id=targetView.model.get("id");var childTag=targetView.model.get("child");var numberChildren=this.collection.where({parent:id,tag:childTag}).length;var wrapper=this.collection.createWrapper(childTag,id,numberChildren,false);var clone=sourceView.model.clone();clone.set("id",clone.cid);clone.set("parent",wrapper.get("id"));clone.set("order",0);this.createTemplate(clone.cid,sourceView);this.collection.add(clone)},createTemplate:function(id,view){var isEditing=view.el.classList.contains("is-editing");this.beforeCopyElement(view);this.appendTemplate(id,view);this.afterCopyElement(id,view);if(isEditing){view.el.classList.add("is-editing")}}});module.exports=ElementModel},{"./model-base":48}],48:[function(require,module,exports){Backbone.Model.prototype.set=_.wrap(Backbone.Model.prototype.set,function(oldSet,key,val,options){if(key==null)return this;var attrs;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});var ret=oldSet.call(this,attrs,options);if(this._tracking){_.each(attrs,_.bind(function(val,key){if(_.isEqual(this._original[key],val)){delete this._unsaved[key]}else{this._unsaved[key]=val}},this))}return ret});var Model=Backbone.Model.extend({_tracking:false,_original:{},_unsaved:{},defaults:function(){return{id:this.cid,tag:"",label:"",atts:{},parent:"",order:0,collection:"element"}},isTracking:function(){return this._tracking},startTracking:function(){this._tracking=true;this.resetTracking();return this},stopTracking:function(){this._tracking=false;this._original={};this._unsaved={};return this},resetTracking:function(){this._original=_.clone(this.attributes);this._unsaved={};return this},resetAttributes:function(){if(!this._tracking){return}this.attributes=this._original;this.resetTracking();this.trigger("change:atts",this,this.get("atts"));return this},toShortcode:function(){var tag=this.get("tag");var atts=this.get("atts");var content="";var shortcode="["+tag;_.each(atts,function(attr,id){if(attr){if("content"===id){content=attr}else{if(_.isNumber(id)){if(/\s/.test(attr)){shortcode+=' "'+attr+'"'}else{shortcode+=" "+attr}}else{shortcode+=" "+id+'="'+attr+'"'}}}},this);return shortcode+"]"+content+"[/"+tag+"]"},insertBefore:function(view){this.trigger("remove:child");this.trigger("insert:before",view);this.trigger("add:child");this.set("parent",view.model.get("parent"))},insertAfter:function(view){this.trigger("remove:child");this.trigger("insert:after",view);this.trigger("add:child");this.set("parent",view.model.get("parent"))},columnBefore:function(view){var model=view.model;var parent=model.get("parent");if("tailor_column"===model.get("tag")){var column=this.collection.createColumn(parent,model.get("order")-1);this.collection.insertChild(this,column)}else{var columns=this.collection.createRow(parent,model.get("order"));this.collection.insertChild(this,_.first(columns));this.collection.insertChild(model,_.last(columns))}},columnAfter:function(view){var model=view.model;var parent=model.get("parent");if("tailor_column"===model.get("tag")){var column=this.collection.createColumn(parent,model.get("order"));this.collection.insertChild(this,column)}else{var columns=this.collection.createRow(parent,model.get("order"));this.collection.insertChild(model,_.first(columns));this.collection.insertChild(this,_.last(columns))}},beforeCopyElement:function(view){var el=view.el;view.triggerAll("before:element:copy",view);el.classList.remove("is-dragging");el.classList.remove("is-hovering");el.classList.remove("is-selected");el.classList.remove("is-editing")},appendTemplate:function(id,view){var oldId=view.model.get("id");var template=document.createElement("script");template.setAttribute("type","text/html");template.id="tmpl-tailor-"+id;template.innerHTML=view.el.outerHTML.replace(oldId,id);document.body.appendChild(template)},afterCopyElement:function(id,view){var oldId=view.model.get("id");view.$el.trigger("element:copy",view);app.channel.trigger("css:copy",oldId,id)}});module.exports=Model},{}],49:[function(require,module,exports){var $=Backbone.$,CompositeModel=require("./model-composite"),ChildModel;ChildModel=CompositeModel.extend({validTarget:function(that,region){if("tailor_section"==that.get("tag")||_.contains(["left","right","center"],region)){return false}var parent=this.collection.getParent(this);if(parent.get("tag")==that.get("tag")){return false}return that.get("tag")==this.get("tag")},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:move:top",this.insertBefore);this.listenTo(this,"element:move:bottom",this.insertAfter);this.listenTo(this,"element:move:left",this.insertBefore);this.listenTo(this,"element:move:right",this.insertAfter);this.listenTo(this,"element:copy:top",this.copyBefore);this.listenTo(this,"element:copy:bottom",this.copyAfter);this.listenTo(this,"element:copy:left",this.copyBefore);this.listenTo(this,"element:copy:right",this.copyAfter)}});module.exports=ChildModel},{"./model-composite":50}],50:[function(require,module,exports){var $=Backbone.$,BaseModel=require("./model-base"),CompositeModel;CompositeModel=BaseModel.extend({cloneContainer:function(sourceView,parent,index){var collection=this.collection;var clone=sourceView.model.clone();clone.set("id",clone.cid);clone.set("parent",parent);clone.set("order",index);this.createTemplate(clone.cid,sourceView);var clonedChildren=this.cloneChildren(sourceView.children,clone,[]);collection.add(clonedChildren,{silent:true});collection.add(clone);sourceView.triggerMethod("element:refresh")},cloneChildren:function(childViews,parent,clones){if(childViews.length){childViews.each(function(childView){var clone=childView.model.clone();clone.set("id",clone.cid);clone.set("parent",parent.get("id"));clone.createTemplate(clone.cid,childView);clones.push(clone);if(childView.children){this.cloneChildren(childView.children,clone,clones)}},this)}return clones},copyBefore:function(targetView,sourceView){this.cloneContainer(sourceView,targetView.model.get("parent"),targetView.model.get("order")-1)},copyAfter:function(targetView,sourceView){this.cloneContainer(sourceView,targetView.model.get("parent"),targetView.model.get("order"))},copyColumnBefore:function(targetView,sourceView){var parent=targetView.model.get("parent");if("tailor_column"===targetView.model.get("tag")){var column=this.collection.createColumn(parent,targetView.model.get("order")-1);this.cloneContainer(sourceView,column.get("id"),0)}else{var columns=this.collection.createRow(parent,targetView.model.get("order"));this.collection.insertChild(targetView.model,_.last(columns));this.cloneContainer(sourceView,_.first(columns).get("id"),0)}},copyColumnAfter:function(targetView,sourceView){var parent=targetView.model.get("parent");if("tailor_column"===targetView.model.get("tag")){var column=this.collection.createColumn(parent,targetView.model.get("order"));this.cloneContainer(sourceView,column.get("id"),0)}else{var columns=this.collection.createRow(parent,targetView.model.get("order"));this.collection.insertChild(targetView.model,_.first(columns));this.cloneContainer(sourceView,_.last(columns).get("id"),0)}},createTemplate:function(id,view){var isEditing=view.el.classList.contains("is-editing");this.beforeCopyElement(view);var $childViewContainer=view.getChildViewContainer(view);var $children=$childViewContainer.contents().detach();this.appendTemplate(id,view);$childViewContainer.append($children);this.afterCopyElement(id,view);if(isEditing){view.el.classList.add("is-editing")}}});module.exports=CompositeModel},{"./model-base":48}],51:[function(require,module,exports){var $=Backbone.$,CompositeModel=require("./model-composite"),ContainerModel;ContainerModel=CompositeModel.extend({validTarget:function(that,region){if("child"==that.get("type")||_.contains(["tailor_section","tailor_column"],that.get("tag"))){return false}var parent=this.collection.getParent(this);if("tailor_row"==that.get("tag")){return"tailor_section"==parent.get("tag")&&_.contains(["top","bottom"],region)}if("center"==region){return"container"!=that.get("type")}if(_.contains(["wrapper","child"],parent.get("type"))){if(_.contains(["top","bottom"],region)){return _.contains(["tailor_section","tailor_column"],parent.get("tag"))||!_.contains(["container","wrapper","child"],that.get("type"))}return"tailor_section"==parent.get("tag")||!_.contains(["left","right"],region)}return"container"!=that.get("type")},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:move:top",this.insertBefore);this.listenTo(this,"element:move:bottom",this.insertAfter);this.listenTo(this,"element:move:left",this.columnBefore);this.listenTo(this,"element:move:right",this.columnAfter);this.listenTo(this,"element:copy:top",this.copyBefore);this.listenTo(this,"element:copy:bottom",this.copyAfter);this.listenTo(this,"element:copy:left",this.copyColumnBefore);this.listenTo(this,"element:copy:right",this.copyColumnAfter)}});module.exports=ContainerModel},{"./model-composite":50}],52:[function(require,module,exports){var $=Backbone.$,CompositeModel=require("./model-composite"),WrapperModel;WrapperModel=CompositeModel.extend({validTarget:function(that,region){if("child"==that.get("type")||_.contains(["tailor_section","tailor_column"],that.get("tag"))||"center"==region){return false}var parent=this.collection.getParent(this);if("tailor_row"==that.get("tag")){return"tailor_section"==parent.get("tag")&&_.contains(["top","bottom"],region)}if("child"==parent.get("type")&&"tailor_column"!=parent.get("tag")){return"container"!=that.get("type")&&!_.contains(["left","right"],region)}if(_.contains(["container","wrapper","child"],parent.get("type"))){return"tailor_section"==parent.get("tag")||!_.contains(["left","right"],region)}return true},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:move:top",this.insertBefore);this.listenTo(this,"element:move:bottom",this.insertAfter);this.listenTo(this,"element:move:left",this.columnBefore);this.listenTo(this,"element:move:right",this.columnAfter);this.listenTo(this,"element:copy:top",this.copyBefore);this.listenTo(this,"element:copy:bottom",this.copyAfter);this.listenTo(this,"element:copy:left",this.copyColumnBefore);this.listenTo(this,"element:copy:right",this.copyColumnAfter);this.listenTo(this,"element:move:center",this.createChild);this.listenTo(this,"element:copy:center",this.copyChild)},createChild:function(targetView,sourceView){var id=targetView.model.get("id");var childTag=targetView.model.get("child");var numberChildren=this.collection.where({parent:id,tag:childTag}).length;this.createTemplate(sourceView.model.get("id"),sourceView);this.collection.createWrapper(childTag,id,numberChildren,sourceView.model)},copyChild:function(targetView,sourceView){var id=targetView.model.get("id");var childTag=targetView.model.get("child");var numberChildren=this.collection.where({parent:id,tag:childTag}).length;var wrapper=this.collection.createWrapper(childTag,id,numberChildren,false);this.cloneContainer(sourceView,wrapper.get("id"),0)}});module.exports=WrapperModel},{"./model-composite":50}],53:[function(require,module,exports){var $=Backbone.$,WrapperModel=require("./../model-wrapper"),SectionModel;SectionModel=WrapperModel.extend({validTarget:function(that,region){return"tailor_section"==that.get("tag")&&!_.contains(["left","right","center"],region)}});module.exports=SectionModel},{"./../model-wrapper":52}],54:[function(require,module,exports){module.exports=Marionette.Module.extend({onStart:function(){this._model=null;this._isDragging=false;this.addEventListeners();this.showCanvas()},addEventListeners:function(){this.listenTo(app.channel,"canvas:dragstart",this.onDragStart);this.listenTo(app.channel,"canvas:dragover",this.onDragOver);this.listenTo(app.channel,"canvas:dragend",this.onDragEnd);this.listenTo(app.channel,"canvas:drop",this.onDrop)},showCanvas:function(){this.collection=app.channel.request("canvas:elements");var Canvas=require("./canvas/canvas");app.canvasRegion.show(new Canvas({collection:this.collection}))},onDragStart:function(e,view){var collection=view.model.collection;if("function"===typeof collection.hasSelectedParent&&collection.hasSelectedParent(view.model)){return}this._view=view;this._model=view.model;this._isDragging=true;view.el.classList.add("is-dragging");if("element"==view.model.get("collection")){var testVar=window.DataTransfer||window.Clipboard;if("setDragImage"in testVar.prototype){var dragImage=document.createElement("img");dragImage.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";e.dataTransfer.setDragImage(dragImage,0,0)}}e.dataTransfer.effectAllowed="copyMove";e.dataTransfer.setData("Text",this._model.cid);e.stopPropagation()},onDragOver:function(e,view){if(!this._isDragging){return}if(e.pageY){var scrollY=window.scrollY||document.documentElement.scrollTop;if(e.pageY-scrollY<40){window.scrollTo(0,scrollY-20)}else if(scrollY+window.innerHeight-e.pageY<40){window.scrollTo(0,scrollY+20)}}var action="element"===this._model.get("collection")&&e.shiftKey?"copy":"move";if("move"===action&&view.model===this._model){this.reset();e.stopPropagation();return}var region=this._getDropRegion(e,view);if(!view.model.validTarget(this._model,region)){return}e.dataTransfer.dropEffect=action;app.channel.trigger("canvas:guide",view,region);e.preventDefault();e.stopPropagation()},onDrop:function(e,view){if(!this._isDragging){return}var model=this._model;var region=this._getDropRegion(e,view);if(!view.model.validTarget(model,region)){return}var action;if("element"===model.get("collection")){action=e.shiftKey?"copy":"move";if("move"===action&&view.model===model){return}}else{action="add"}model.trigger("element:"+action+":"+region,view,this._view);app.channel.trigger("element:"+action,model);this.collection.sort({silent:true});e.preventDefault();e.stopPropagation()},onDragEnd:function(e,view){if(!this._isDragging){return}this._isDragging=false;this._view.el.classList.remove("is-dragging");this.reset();app.channel.trigger("debug")},reset:function(){app.channel.trigger("canvas:reset")},_getPoint:function(e){if(e.targetTouches){return{x:e.targetTouches[0].clientX,y:e.targetTouches[0].clientY}}return{x:e.clientX,y:e.clientY}},_getDropRegion:function(e,view){var point=this._getPoint(e);var rect=view.el.getBoundingClientRect();var width=rect.width/2;var height=rect.height/2;var top=rect.top+(rect.height-height)/2;var left=rect.left+(rect.width-width)/2;if(left<=point.x&&point.x<=left+width&&top<=point.y&&point.y<=top+height){return"center"}else{var x=(point.x-(rect.left+width))/width;var y=(point.y-(rect.top+height))/height;if(Math.abs(x)>Math.abs(y)){return x>0?"right":"left"}return y>0?"bottom":"top"}}})},{"./canvas/canvas":56}],55:[function(require,module,exports){module.exports=Backbone.Marionette.Region.extend({initialize:function(){this.listenTo(app.channel,"canvas:dragstart",this.onDragStart);this.listenTo(app.channel,"canvas:dragend",this.onDragEnd)},onDragStart:function(view,region,options){this.el.classList.add("is-active")},onDragEnd:function(view,region,options){
this.el.classList.remove("is-active")}})},{}],56:[function(require,module,exports){module.exports=Marionette.CollectionView.extend({behaviors:{Container:{}},getChildView:function(child){return window.Tailor.Views.lookup("TailorSection")},buildChildView:function(child,ChildViewClass,childViewOptions){var options=_.extend({model:child,collection:this.collection},childViewOptions);return new ChildViewClass(options)},filter:function(child,index,collection){return!child.get("parent")},_updateIndices:function(view,increment,index){if(increment){view._index=index;view.model._changing=false;view.model.set("order",index)}this.children.each(function(laterView){if(laterView._index>=view._index){laterView._index+=increment?1:-1;laterView.model.set("order",laterView._index)}},this)}})},{}],57:[function(require,module,exports){module.exports=Marionette.Module.extend({onStart:function(options){this.stylesheets=[];this.createSheets(options.mediaQueries||{});this.addRules(options.cssRules||{});this.addEventListeners()},addEventListeners:function(){var collection=app.channel.request("canvas:elements");this.listenTo(collection,"destroy",this.onDestroy);this.listenTo(app.channel,"css:add",this.addRules);this.listenTo(app.channel,"css:update",this.updateRules);this.listenTo(app.channel,"css:delete",this.deleteRules);this.listenTo(app.channel,"css:clear",this.clearRules);this.listenTo(app.channel,"css:copy",this.copyRules)},createSheets:function(mediaQueries){var Stylesheet=require("./stylesheet/stylesheet");_.each(mediaQueries,function(queryAtts,queryId){if(""!=queryAtts.min){if(""!=queryAtts.max){this.stylesheets[queryId]=new Stylesheet(queryId,"only screen and (min-width: "+queryAtts.min+") and (max-width: "+queryAtts.max+")");this.stylesheets[queryId+"-up"]=new Stylesheet(queryId+"-up","only screen and (min-width: "+queryAtts.min+")")}else{this.stylesheets[queryId]=new Stylesheet(queryId,"only screen and (min-width: "+queryAtts.min+")")}}else{if(""!=queryAtts.max){this.stylesheets[queryId]=new Stylesheet(queryId,"only screen and (max-width: "+queryAtts.max+")")}else{this.stylesheets[queryId]=new Stylesheet(queryId,"only screen")}}},this)},onDestroy:function(model){this.deleteRules(model.get("id"))},addRules:function(cssRules){_.each(cssRules,function(queryRules,queryId){if(queryId in this.stylesheets){this.stylesheets[queryId].addRules(queryRules)}},this)},clearRules:function(){for(var queryId in this.stylesheets){if(this.stylesheets.hasOwnProperty(queryId)){this.stylesheets[queryId].clearRules()}}},copyRules:function(originalId,copyId){for(var queryId in this.stylesheets){if(this.stylesheets.hasOwnProperty(queryId)){var rules=this.stylesheets[queryId].copyRules("tailor-"+originalId,"tailor-"+copyId);if(rules.length){var rulesSet={};rulesSet[queryId]={};rulesSet[queryId][copyId]=rules;this.addRules(rulesSet)}}}},deleteRules:function(elementId){for(var queryId in this.stylesheets){if(this.stylesheets.hasOwnProperty(queryId)){this.stylesheets[queryId].deleteRules("tailor-"+elementId)}}},updateRules:function(elementId,cssRules){this.deleteRules(elementId);this.addRules(cssRules)}})},{"./stylesheet/stylesheet":58}],58:[function(require,module,exports){function Stylesheet(id,media){this.id=id;this.elements=[];this.initialize(media)}Stylesheet.prototype={initialize:function(media){this.stylesheet=this.createStylesheet(media);this.sheet=this.stylesheet.sheet},createStylesheet:function(media){var style=document.createElement("style");style.appendChild(document.createTextNode(""));media=media||"screen";style.setAttribute("media",media);style.setAttribute("id","tailor-"+this.id);document.head.appendChild(style);return style},addRules:function(ruleSet){_.each(ruleSet,function(rules,elementId){rules.forEach(function(rule){if("selectors"in rule&&"declarations"in rule){Tailor.CSS.addRule(this.sheet,rule.selectors,rule.declarations,"tailor-"+elementId)}},this)},this)},copyRules:function(elementId,newElementId){var rules=[];for(var i=0;i<this.sheet.cssRules.length;i++){var rule=this.sheet.cssRules[i];if(rule.selectorText&&rule.selectorText.indexOf(elementId)>-1){rules.push({selectors:rule.selectorText.replace(new RegExp(elementId,"g"),newElementId),declarations:rule.style.cssText})}}return rules},deleteRules:function(elementId){for(var i=0;i<this.sheet.cssRules.length;i++){var rule=this.sheet.cssRules[i];if(rule.selectorText&&rule.selectorText.indexOf(elementId)>-1){Tailor.CSS.deleteRule(this.sheet,i);i--}}},clearRules:function(){for(var i=0;i<this.sheet.cssRules.length;i++){Tailor.CSS.deleteRule(this.sheet,i);i--}}};module.exports=Stylesheet},{}],59:[function(require,module,exports){module.exports=Marionette.Module.extend({onStart:function(){var GuideView=require("./tools/show/guide");var SelectorView=require("./tools/show/select");var guide=new GuideView({el:"#guide"});guide.render();var api={positionGuide:function(view,drop){guide.position(view,drop)},selectElement:function(view){app.selectRegion.show(new SelectorView({model:view.model,collection:app.channel.request("canvas:elements"),view:view}))},resetGuide:function(){guide.reset();app.selectRegion.empty()},getSelectedElement:function(){var select=app.selectRegion.currentView;return select?select.model:null}};this.listenTo(app.channel,"canvas:guide",api.positionGuide);this.listenTo(app.channel,"canvas:select",api.selectElement);this.listenTo(app.channel,"canvas:reset element:refresh:template",api.resetGuide);app.channel.reply("canvas:element:selected",api.getSelectedElement)}})},{"./tools/show/guide":61,"./tools/show/select":63}],60:[function(require,module,exports){module.exports=Backbone.Marionette.Region.extend({onShow:function(view,region,options){view._view.el.classList.add("is-selected")},onEmpty:function(view,region,options){view._view.el.classList.remove("is-selected")}})},{}],61:[function(require,module,exports){module.exports=Marionette.ItemView.extend({template:false,position:function(view,drop){var $el=view.$el;var offset=$el.offset();var parentOffset=this.$el.offsetParent().offset();this.el.style.visibility="visible";this.el.className="guide guide--"+drop+" guide--"+view.model.get("tag");this.el.style.left=offset.left-parentOffset.left+"px";this.el.style.top=offset.top-parentOffset.top+"px";this.el.style.width=$el.outerWidth()+"px";this.el.style.height=$el.outerHeight()+"px";this.el.style.opacity=1},reset:function(){this.el.style.visibility="hidden";this.el.style.opacity=0}})},{}],62:[function(require,module,exports){module.exports=Marionette.ItemView.extend({tagName:"a",className:"select__item",events:{click:"onClick"},getTemplate:function(){return _.template("<%= label %>")},onClick:function(e){if(0===this._index){this.triggerMethod("toggle")}else{this.model.trigger("select")}e.stopPropagation()}})},{}],63:[function(require,module,exports){module.exports=Marionette.CompositeView.extend({className:"select",childView:require("./menu-item"),childViewContainer:".select__menu",ui:{edit:".js-edit","delete":".js-delete"},events:{"click @ui.edit":"editElement","click @ui.delete":"deleteElement"},childEvents:{toggle:"toggleMenu"},template:"#tmpl-tailor-tools-select",serializeData:function(){var data=Backbone.Marionette.CompositeView.prototype.serializeData.apply(this,arguments);data.siblings=this.collection.where({parent:this.model.get("parent")}).length;return data},initialize:function(options){this._view=options.view;this._model=this._view.model},_filteredSortedModels:function(){var models=[];var model=this.model;while("undefined"!==typeof model){models.push(model);model=this.collection.get(model.get("parent"))}return models},onDomRefresh:function(){var thisRect=this.el.parentNode.getBoundingClientRect();var thatRect=this._view.el.getBoundingClientRect();this.el.style.top=thatRect.top-thisRect.top+"px";this.el.style.left=thatRect.left-thisRect.left+"px";this.el.style.width=thatRect.width+"px";this.el.style.height=thatRect.height+"px"},editElement:function(){app.channel.trigger("modal:open",this.model)},deleteElement:function(){this.model.trigger("destroy",this.model);app.channel.trigger("element:delete",this.model)},toggleMenu:function(){this.$el.toggleClass("is-expanded")}})},{"./menu-item":62}],64:[function(require,module,exports){var $=jQuery,Ajax;var Ajax={url:window.ajaxurl,post:function(action,data){return ajax.send({data:_.isObject(action)?action:_.extend(data||{},{action:action})})},send:function(action,options){if(_.isObject(action)){options=action}else{options=options||{};options.data=_.extend(options.data||{},{action:action,tailor:1})}options=_.defaults(options||{},{type:"POST",url:ajax.url,context:this});return $.Deferred(function(deferred){if(options.success){deferred.done(options.success)}var onError=options.error?options.error:ajax.onError;deferred.fail(onError);delete options.success;delete options.error;$.ajax(options).done(function(response){if(response==="1"||response===1){response={success:true}}if(_.isObject(response)&&!_.isUndefined(response.success)){deferred[response.success?"resolveWith":"rejectWith"](this,[response.data])}else{deferred.rejectWith(this,[response])}}).fail(function(){deferred.rejectWith(this,arguments)})}).promise()},onError:function(response){if(response&&response.hasOwnProperty("message")){Tailor.Notify(response.message)}else if("0"==response){Tailor.Notify(window._l10n.expired)}else if("-1"==response){Tailor.Notify(window._l10n.invalid)}else{Tailor.Notify(window._l10n.error)}}};module.exports=Ajax},{}],65:[function(require,module,exports){var $=Backbone.$,CSS;CSS={addRule:function(sheet,selectors,declarations,elementId){var selectorString=Tailor.CSS.parseSelectors(selectors,elementId);var declarationString=Tailor.CSS.parseDeclarations(declarations);if("insertRule"in sheet){sheet.insertRule(selectorString+" {"+declarationString+"}",sheet.cssRules.length)}else if("addRule"in sheet){sheet.addRule(selectorString,declarationString,sheet.cssRules.length)}},deleteRule:function(sheet,index){if("deleteRule"in sheet){sheet.deleteRule(index)}else if("removeRule"in sheet){sheet.removeRule(index)}},parseSelectors:function(selectors,elementId){if(_.isString(selectors)){return selectors}var elementClass=elementId?"."+elementId:"";var selector;if(!selectors.length){selector=elementClass?".tailor-ui "+elementClass:""}else{if(elementClass){selectors=selectors.map(function(selector){if(selector.indexOf("&")>-1){selector=selector.replace("&",elementClass)}else if(":"==selector.charAt(0)){selector=elementClass+selector}else{selector=elementClass+" "+selector}return selector})}selector=".tailor-ui "+selectors.join(",.tailor-ui ")}return selector},parseDeclarations:function(declarations){if(_.isString(declarations)){return declarations}var declaration="";_.each(declarations,function(value,property){declaration+=property+":"+value+";"});return declaration}};module.exports=CSS},{}],66:[function(require,module,exports){(function(){if("undefined"===typeof window.Element||"classList"in document.documentElement){return}var prototype=Array.prototype,push=prototype.push,splice=prototype.splice,join=prototype.join;function DOMTokenList(el){this.el=el;var classes=el.className.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var i=0;i<classes.length;i++){push.call(this,classes[i])}}DOMTokenList.prototype={add:function(token){if(this.contains(token)){return}push.call(this,token);this.el.className=this.toString()},contains:function(token){return this.el.className.indexOf(token)!=-1},item:function(index){return this[index]||null},remove:function(token){if(!this.contains(token)){return}for(var i=0;i<this.length;i++){if(this[i]==token){break}}splice.call(this,i,1);this.el.className=this.toString()},toString:function(){return join.call(this," ")},toggle:function(token){if(!this.contains(token)){this.add(token)}else{this.remove(token)}return this.contains(token)}};window.DOMTokenList=DOMTokenList;function defineElementGetter(obj,prop,getter){if(Object.defineProperty){Object.defineProperty(obj,prop,{get:getter})}else{obj.__defineGetter__(prop,getter)}}defineElementGetter(Element.prototype,"classList",function(){return new DOMTokenList(this)})})()},{}],67:[function(require,module,exports){(function(window){"use strict";var lastTime=0,vendors=["ms","moz","webkit","o"];for(var x=0;x<vendors.length&&!window.requestAnimationFrame;++x){window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(callback,el){var currTime=(new Date).getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);lastTime=currTime+timeToCall;return id}}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(id){clearTimeout(id)}}})(window)},{}]},{},[6]);